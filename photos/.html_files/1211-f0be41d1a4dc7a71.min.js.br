"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="3c85b371-be3e-5b55-98be-8c99e3b36a62")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[1211],{826715:(e,t,r)=>{r.d(t,{c:()=>c});var i=r(266808),a=r(812714),n=r(795033),s=r(770366),o=r(809565),l=r(173485),d=r(203144);async function c(e={}){let{blockOnJoin:t=!1,joinTimeoutMs:r=5e3}=e;if(t&&!(0,d.eN)()&&(0,a.kc)().multiplayer_wait_for_joined_state_before_flush){let e=performance.now(),t=Symbol("timeout"),a=(0,d.oJ)(i.kul.JOINED),n=new Promise(e=>setTimeout(()=>e(t),r)),o=await Promise.race([a,n]),l=performance.now()-e,c=o===t;if((0,s.rI)([{metric:"web.multiplayer.flush.wait_for_joined_state.duration_ms",value:l,tags:{success:c?"false":"true"}}]),c)throw Error(`Timeout waiting for multiplayer state JOINED after ${r}ms`)}return i.h3O?.flush(),await (0,l.l)(),n.zl.get(o.J)}},612953:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(408825),a=r(113139),n=r(869450);let s=i.z.object({js_url:i.z.string(),css_url:i.z.string()}),o=new class{constructor(){this.GetCachedPreviewUrlsValidator=(0,a.YV)("GetCachedPreviewUrlsValidator",(0,n.D)(s),null)}getCachedPreviewUrls(e){return this.GetCachedPreviewUrlsValidator.validate(async({xr:t})=>await t.get(`/api/make/${e.fileKey}/cached_preview_urls`,{source_code_hash:e.sourceCodeHash}))}}},472207:(e,t,r)=>{r.d(t,{e:()=>i});let i="https://go/figmascope-docs"},787538:(e,t,r)=>{r.d(t,{rf:()=>s,tV:()=>o,zG:()=>n});var i=r(104076),a=r(659062);function n(){return(0,i.jsx)(o,{children:(0,i.jsx)("p",{children:"Reading file..."})})}function s({error:e}){let t="Oops! Something went wrong";return"string"==typeof e?t=e:e instanceof Error&&(t=e.message,console.error(e)),(0,i.jsx)(o,{children:(0,i.jsx)("p",{style:a.sx.colorTextOndanger.colorBgDanger.p16.font20.maxW400.$,children:t})})}function o({children:e}){return(0,i.jsx)("div",{style:a.sx.fillPositionedContainer.flex.itemsCenter.justifyCenter.flexColumn.lh1_5Lines.font16.$,children:e})}},123315:(e,t,r)=>{r.d(t,{J:()=>tm});var i=r(104076),a=r(716976),n=r(187714),s=r(795033),o=r(901014),l=r(222714),d=r(221586),c=r(514223),u=r(659062),p=r(569963),h=r(284068),f=r(383947),g=r(432099),m=r(657878),y=r(377399),b=r(800108),v=(e=>(e[e.Fetched=0]="Fetched",e[e.Fetching=1]="Fetching",e[e.NeverFetched=2]="NeverFetched",e))(v||{});let k=(0,s.eU)(e=>{let t=e(m.OC);return"fullscreen"===t.view?`/api/file/scenegraph_validations/${t.fileKey}`:(0,y.E)(t)&&t.urlParams?.type==="server_file"?`/api/admin/scenegraph_validations/${t.urlParams.key}`:null}),S=(0,s.eU)(e=>null!=e(k)),w=(()=>{let e=(0,s.eU)((0,f.Ok)());return(0,s.eU)(t=>t(e),async(t,r)=>{let i;if(t(e).status===c.r.LOADING)return;let a=t(k);if(a){r(e,(0,f.ux)());try{i=await I(a)}catch(t){r(e,(0,f.uW)(t));return}r(e,(0,f.NY)(i))}})})();async function I(e){let t=await (0,g.GD)(e),r=new b._;for(let e of t.data.meta.data.results.violations)if("always-fail-for-testing"!==e.name)for(let t of e.instances)r.add(t.guid,t.message);return r}var _=r(617748),x=r(707425),O=r(787538),N=r(255054),C=r(843717),T=r(999083),P=r(266808),E=r(824570),j=r(957501),F=r.n(j),A=r(236631),M=r(911990),L=r(585627);let R=(0,x.Sv)("bookmarkSettings",{bookmarks:{}}),J=(0,s.eU)(e=>{let t=e(R),r=e(h.Cc).id;return new Set((t.bookmarks[r]??[]).map(e=>e.id))});function D(){let[e,t]=(0,s.fp)(R),r=(0,s.md)(h.Cc).id,i=a.useCallback(i=>{t({...e,bookmarks:{...e.bookmarks,[r]:i(e.bookmarks[r]||[])}})},[e,r,t]),n=a.useCallback((e,t)=>{i(r=>[...r,{id:e,name:t}])},[i]),o=a.useCallback(e=>{i(t=>t.filter((t,r)=>r!==e))},[i]),l=a.useCallback((e,t)=>{i(r=>r.map((r,i)=>i===e?{...r,name:t}:r))},[i]),d=a.useCallback((e,t)=>{i(r=>r.map((r,i)=>i===e?{...r,id:L.SW.fromString(t)}:r))},[i]);return{addBookmark:n,deleteBookmark:o,moveBookmarkDown:a.useCallback(e=>{i(t=>{if(e>=t.length-1)return t;let r=t.slice(),[i]=r.splice(e,1);return r.splice(e+1,0,i),r})},[i]),moveBookmarkUp:a.useCallback(e=>{i(t=>{if(e<=0)return t;let r=t.slice(),[i]=r.splice(e,1);return r.splice(e-1,0,i),r})},[i]),renameBookmark:l,updateBookmarkId:d,bookmarks:a.useMemo(()=>e.bookmarks[r]||[],[e,r])}}var V=r(674473);function U(e,t,r){return[...e.getObject(r)?.mapDescendants(e=>e.id)??[],...t?.getObject(r)?.mapDescendants(e=>e.id)??[]]}let K=(0,s.FZ)((0,s.eU)({}),(e,t,r)=>{let i=r(h.Cc),a=r(h.lX);switch(t.type){case"toggleExpanded":return(0,V.X9)(e,t.objectId,t.toggleSubtree?U(i,a,t.objectId):[]);case"expandAncestors":return(0,V.nE)(e,function(e,t,r){return[...e.getObject(r)?.mapAncestors(e=>e.id)??[],...t?.getObject(r)?.mapAncestors(e=>e.id)??[]]}(i,a,t.objectId),!0);case"expandDescendants":return(0,V.nE)(e,[t.objectId,...U(i,a,t.objectId)],!0);case"collapseDescendants":return(0,V.IO)(e,[t.objectId,...U(i,a,t.objectId)])}});var H=r(99723),z=r(382629),B=r(115069);let G=(0,s.eU)({status:"initial"}),$=(0,s.eU)(0),q=(0,s.eU)(!1),X=(0,s.eU)(e=>{if(e(q)){let t=e($);return`Indexing search results (this may take a moment)... [${t}/???]`}return null}),Q=(0,x.Sv)("searchMode",x.Y6.Search),Y=(0,s.eU)(e=>{let t=e(G),r=e(h.Cc),i=e(_.Sd);return"initial"===t.status?i.map(e=>r.getObject(e)).filter(z.Vq).map(e=>({object:e,matches:[]})).reverse():"results"in t&&t.results.length>0?t.results:null}),W=(0,s.eU)(e=>{let t=e(G);if("searching"===t.status&&0===t.results.length){let t=["Searching..."],r=e(X);return r&&t.push(r),t}if("success"===t.status&&0===t.results.length){let t=["No results found."],r=e(h.Cc);return r instanceof B.G2&&t.push("Some content may be unavailable because of incremental loading"),"hide"===r.sensitiveTextPolicy&&t.push("Searching text fields is limited beacuse text redaction has been applied."),t}return"error"===t.status?["Error searching:",String(t.error)]:null}),Z=(0,s.eU)(e=>{if(e(Q)!==x.Y6.Filter)return null;let t=e(G);return"results"in t?t.results.map(e=>e.object):null}),ee=(0,s.eU)(e=>{if(e(Q)!==x.Y6.Filter)return null;let t=e(W);return t?t.join(" "):null}),et=(0,x.Sv)("sortOrder",x.hX.Position),er=(0,s.eU)(e=>{let t=[x.hX.Position,x.hX.Name,x.hX.NodeId];return e(h.Cc).rootObjects[0]?.displayProperties.memoryFraction!=null&&t.push(x.hX.Memory),t.sort(),t}),ei=(0,s.eU)(e=>{switch(e(et)){case x.hX.Position:return en;case x.hX.Name:return ea;case x.hX.Memory:return eo;case x.hX.NodeId:return es}});function ea(e,t){return e.displayProperties.name.localeCompare(t.displayProperties.name)}function en(e,t){let[r,i]=el(e,t);if(r&&i){let e=r.parentIndex?.position,t=i.parentIndex?.position;if(null==e&&null==t)return 0;if(null==t)return 1;if(null==e)return -1;if(e<t)return -1;else if(e>t)return 1}return ea(e,t)}function es(e,t){let[r,i]=el(e,t);if(r&&i){let{sessionID:e,localID:t}=r.guid??{localID:-1,sessionID:-1},{sessionID:a,localID:n}=i.guid??{localID:-1,sessionID:-1};return e-a||t-n}return en(e,t)}function eo(e,t){return(t.displayProperties.memoryFraction??0)-(e.displayProperties.memoryFraction??0)||en(e,t)}function el(e,t){return"nodeChange"in e&&"nodeChange"in t?[e.nodeChange,t.nodeChange]:[null,null]}var ed=r(727989),ec=r(403671),eu=r(110178),ep=r(665261),eh=r(192075),ef=r(770484),eg=r(66293);let em=ep.ms,ey=ep.c$,eb=ep.wv;function ev({contextMenuData:{objectId:e,position:t},onClose:r}){let[n,o]=a.useState(0),l=t.left,d=t.top+n>window.innerHeight?t.top-n:t.top,{canSelectInApp:c,selectInApp:f}=a.useContext(_.H$),g=a.useRef(null);(0,eu.ww)(g,r);let m=(0,s.md)(h.Cc).getObject(e),y=m instanceof eg.R?m:null,b=m instanceof ef.E?m:null,[v,k]=(0,s.fp)(p.Oz),S=(0,s.Xr)(K);if(null==m)return null;let w=e=>()=>{e(),r()},I=m.children.length>0,x=(()=>{if(c?.(m))return w(()=>f(m))})(),O=e=>w(()=>P.glU?.triggerAction(e,{guid:m.id})),N=v?.object.id===m.id;return(0,i.jsx)(em,{style:{...u.sx.fixed.$,left:l,top:d},dropdownRef:e=>{e&&o(e.clientHeight)},children:(0,i.jsxs)("div",{ref:g,children:[x&&(0,i.jsx)(ey,{onClick:x,children:"Jump to node"}),I&&(0,i.jsx)(ey,{onClick:w(()=>S({type:"expandDescendants",objectId:e})),children:"Expand descendants"}),I&&(0,i.jsx)(ey,{onClick:w(()=>S({type:"collapseDescendants",objectId:e})),children:"Collapse descendants"}),(x||I)&&(0,i.jsx)(eb,{}),N&&(0,i.jsx)(ey,{onClick:w(()=>k({type:"clear"})),children:"Stop diffing against this node"}),(!N||v?.type!==p.Lp.Layer)&&(0,i.jsx)(ey,{onClick:w(()=>k({type:"start",diffType:p.Lp.Layer,id:e})),children:"Layer diff against this node"}),(!N||v?.type!==p.Lp.Tree)&&(0,i.jsx)(ey,{onClick:w(()=>k({type:"start",diffType:p.Lp.Tree,id:e})),children:"Tree diff against this node"}),y&&(0,i.jsx)(eb,{}),y&&(0,i.jsx)(ey,{onClick:w(()=>{let e=JSON.stringify(y.nodeChange,null,2);navigator.clipboard.writeText(e)}),children:"Copy NodeChange JSON"}),b&&"DOCUMENT"!==b.type&&"CANVAS"!==b.type&&(0,i.jsx)(ey,{onClick:O("debug-print-as-test-code"),children:(0,eh.tx)("fullscreen_actions.debug-print-as-test-code")}),b&&"VECTOR"===b.type&&(0,i.jsx)(ey,{onClick:O("debug-print-vector-network-as-test-code"),children:(0,eh.tx)("fullscreen_actions.debug-print-vector-network-as-test-code")})]})})}var ek=r(62084);let eS=a.memo(function({diffType:e,id:t,primaryId:r,secondaryId:n,leftBadges:s,indent:o,index:l,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:p,memoryFraction:h,rightBadges:f,name:g,style:m,select:y,toggle:b,showContextMenu:v}){let k=a.useCallback(e=>{e.preventDefault(),v({objectId:t,position:{left:e.clientX,top:e.clientY}})},[t,v]);return(0,i.jsxs)(ek.Z,{changeType:e,indent:o,isExpanded:d,isLeaf:c,isSelected:u,isSelectedSecondary:p,keyboardNavigationPath:[l],onContextMenu:k,onMouseEnter:()=>{P.Ez5&&P.Ez5.editorState().figmaScopeHighlightedNode.set(t)},onMouseLeave:()=>{P.Ez5&&P.Ez5.editorState().figmaScopeHighlightedNode.set("")},select:()=>y(t),style:m,toggleExpanded:e=>b(t,e),children:[(0,i.jsx)(ed.IV,{badges:s}),(0,i.jsx)(ec.nK,{id:r}),n&&(0,i.jsx)(ec.nK,{id:n,secondary:!0}),(0,i.jsx)("div",{title:g,className:A.s.ellipsis.noWrap.overflowHidden.$,children:g}),(0,i.jsx)(M.M,{}),(0,i.jsx)(ed.IV,{badges:f}),null!=h&&(0,i.jsxs)("span",{className:A.s.colorTextSecondary.$,title:"Node memory usage",children:[(100*h).toFixed(3),"%"]})]})});function ew({style:e,data:{displayedObjects:t,selectedId:r,selectedIds:a,...n},index:s}){let o=t[s],l=(0,E.zN)(e);return(0,i.jsx)(eS,{...o,...n,isSelected:r===o.id,isSelectedSecondary:!!o&&a.includes(o.id),style:l,index:s})}let eI=[];function e_({appSelection:e}){let t=(0,s.md)(ex),[r,n]=(0,s.fp)(_.AJ),o=(0,E.k9)(()=>e?.guids??eI,[e?.guids]),[l,d]=a.useState(null),c=a.useRef(null);a.useEffect(()=>{let e=t.findIndex(e=>e.id===r);e>=0&&c.current?.scrollToItem(e,"smart")},[t,r]);let u=(0,s.Xr)(K);a.useEffect(()=>{u({type:"expandAncestors",objectId:r})},[u,r]);let p=a.useCallback((e,t)=>{u({type:"toggleExpanded",objectId:e,toggleSubtree:t})},[u]),h=(0,s.md)(ee);return 0===t.length?(0,i.jsx)("div",{children:h??"Empty Scene"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(N.A,{disableWidth:!0,children:({height:e})=>(0,i.jsx)(C.Y1,{itemSize:18,itemCount:t.length,height:e,ref:c,itemData:{displayedObjects:t,selectedId:r,selectedIds:o,select:n,toggle:p,showContextMenu:d},width:"100%",children:ew})}),l&&(0,i.jsx)(ev,{contextMenuData:l,onClose:()=>{d(null)}})]})}let ex=(0,s.eU)(e=>{let t=e(J),r=e(h.Cc);return(e(eO)??e(eN)).map(e=>({...e,rightBadges:[...e.rightBadges,...t.has(e.id)?[{type:"bookmark",value:"Bookmarked"}]:[],...r.getAdditionalBadges?.(e.id)||[]]}))}),eO=(0,s.eU)(e=>{let t=e(Z);return t?t.map(e=>({...e.displayProperties,diffType:void 0,id:e.id,indent:0,isExpanded:!1,isLeaf:!0})):null}),eN=(0,s.eU)(e=>{let t=e(h.Cc).rootObjects,r=e(p.sg),i=e(K),a=e(ei),n=(()=>{switch(r.type){case p.Lp.Tree:return[r.object];case p.Lp.Full:return r.resource.rootObjects;default:return[]}})(),s={sortFn:a,expandedIds:i};return F()(t,e=>{if(!e)return[];if(0===n.length)return eC(e,0,s);let t=eP(e,n);return t?eT(e,t,0,s):function e(t,r,i,a){let n=t.id,s=t.children,o=0===s.length,l=!!a.expandedIds[n],d=!1,c=F()(s,t=>{let n=(()=>{let n=eP(t,r);if(n)return eT(t,n,i+1,a);let s=r.filter(e=>e.someAncestor(e=>e.id===t.id,{includeSelf:!0}));return s.length>0?e(t,s,i+1,a):eC(t,i+1,a)})();return d=d||n[0]?.diffType!=null,n}),u={...t.displayProperties,diffType:d?"CHILD_MODIFIED":void 0,id:n,indent:i,isExpanded:l,isLeaf:o};return l?[u,...c]:[u]}(e,n,0,s)})});function eC(e,t,r){let i=e.id,a=e.children,n=0===a.length,s=!!r.expandedIds[i],o={...e.displayProperties,diffType:void 0,id:i,indent:t,isExpanded:s,isLeaf:n};return s?[o,...F()(eE(a,r.sortFn),e=>eC(e,t+1,r))]:[o]}function eT(e,t,r,i){let a=e??t;if(!a)throw Error("Diffing two nothings");if(e&&t&&e.id!==t.id)throw Error("Diffing nodes with mismatched keys");let n=a.id,s=eE(e?.children??[],i.sortFn),o=eE(t?.children??[],i.sortFn),l=(0,T.TR)(s,o,e=>e.id),d=!1,c=F()(l,({left:e,right:t})=>{let a=eT(e,t,r+1,i);return d=d||a[0]?.diffType!=null,a}),u=(0,p.wc)(e,t,d),h=e?.displayProperties.name,f=t?.displayProperties.name,g=null!=h&&null!=f&&h!==f?`${h} <=> ${f}`:a.displayProperties.name,m=!!i.expandedIds[n],y={...a.displayProperties,diffType:u,id:n,indent:r,isExpanded:m,isLeaf:0===l.length,name:g};return m?[y,...c]:[y]}function eP(e,t){return t.find(t=>t.id===e.id)}function eE(e,t){return e.slice().sort(t)}var ej=r(307829),eF=r(420680),eA=r(32557);r(120440);var eM=r(826220),eL=r(268389),eR=r(162954),eJ=r(208754),eD=r(760238),eV=r(368422),eU=r(927287),eK=r(36758),eH=r(523657),ez=r(390579);function eB(e){let{bookmarks:t,deleteBookmark:r,moveBookmarkDown:n,moveBookmarkUp:s,renameBookmark:o,updateBookmarkId:l}=D();return(0,i.jsx)(eM.bL,{defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},onClose:e.onClose,width:400,children:(0,i.jsxs)(eL.vo,{children:[(0,i.jsx)(eL.Y9,{children:(0,i.jsx)(eL.hE,{children:"FigmaScope Bookmarks"})}),(0,i.jsx)(eL.nB,{children:(0,i.jsxs)(eR.bL,{className:"xrvj5dj x1nfngrj",children:[0===t.length&&(0,i.jsx)("div",{className:"x6s0dn4 x78zum5 xpyat2d xl56j7k",children:"No bookmarks"}),t.length>0&&(0,i.jsxs)(eJ.fI,{className:"xrvj5dj xuhvigx xg2d0mh",children:[(0,i.jsx)(eD.fh,{children:"Name"}),(0,i.jsx)(eD.fh,{children:"ID"})]}),t.map((e,d)=>(0,a.createElement)(eJ.fI,{className:"xrvj5dj xuhvigx xg2d0mh",key:d},(0,i.jsx)(eD.fh,{children:(0,i.jsx)(eV.p,{id:`edit-bookmark-name-${d}`,value:e.name,onChange:e=>o(d,e)})}),(0,i.jsx)(eD.fh,{children:(0,i.jsx)(eV.p,{id:`edit-bookmark-id-${d}`,value:e.id,onChange:e=>l(d,e)})}),(0,i.jsx)(eD.fh,{children:(0,i.jsxs)(eU.e,{"aria-label":`Bookmark actions for ${e.name}`,children:[(0,i.jsx)(eF.K,{"aria-label":"Delete bookmark",onClick:()=>r(d),children:(0,i.jsx)(eK.i,{})}),(0,i.jsx)(eF.K,{"aria-label":"Move bookmark up",disabled:0===d,onClick:()=>s(d),children:(0,i.jsx)(eH.t,{})}),(0,i.jsx)(eF.K,{"aria-label":"Move bookmark down",disabled:d===t.length-1,onClick:()=>n(d),children:(0,i.jsx)(ez.O,{})})]})})))]})})]})})}function eG(){let[e,t]=(0,s.fp)(_.AJ),r=(0,s.md)(_.gg),{getTriggerProps:n,manager:o}=ej.b(),{addBookmark:l,bookmarks:d}=D(),[c,u]=a.useState(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(ej.bL,{manager:o,children:[(0,i.jsx)("div",{className:"xrybvsa",children:(0,i.jsx)(eF.K,{...n(),"aria-label":"bookmarks",children:(0,i.jsx)(eA.j,{})})}),(0,i.jsxs)(ej.mc,{children:[(0,i.jsxs)(ej.YJ,{title:(0,i.jsx)(ej.r1,{children:"Bookmark settings"}),children:[(0,i.jsx)(ej.q7,{onClick:()=>{let t=r?.displayProperties.name??"Bookmark";l(e,`${t} - ${e}`)},children:"Add bookmark"}),(0,i.jsx)(ej.q7,{onClick:()=>{u(!0)},children:"Manage bookmarks"})]}),d.length?(0,i.jsx)(ej.YJ,{title:(0,i.jsx)(ej.r1,{children:"Bookmark list"}),children:d.map((e,r)=>(0,i.jsx)(ej.q7,{onClick:()=>{t(e.id)},children:e.name},r))}):null]})]}),c&&(0,i.jsx)(eB,{onClose:()=>u(!1)})]})}var e$=r(511570),eq=r.n(e$),eX=r(150062),eQ=r(848561);function eY({searchRef:e}){let t=(0,s.Xr)(_.AJ),r=(0,s.md)(Y),n=(0,s.md)(W),[o,l]=a.useState(!1),d=(0,s.md)(Q)!==x.Y6.Filter&&o,c=a.useRef(null);(0,eu.ww)(c,()=>l(!1));let u=a.useCallback(e=>{l(!1),t(e.object.id)},[l,t]);return(0,i.jsxs)(eQ.dP,{className:A.s.flex1.$,ref:c,allowVim:!0,children:[(0,i.jsx)(eW,{searchRef:e,setShowSearchResults:l}),d&&(r?(0,i.jsx)(e0,{searchResults:r,selectResult:u}):n?(0,i.jsx)(e1,{text:n}):null)]})}function eW({searchRef:e,setShowSearchResults:t}){let r=(0,s.md)(Q),n=function(){let e=(0,s.md)(h.Cc),t=(0,s.Xr)(G),r=(0,s.Xr)($),i=(0,s.Xr)(q),n=a.useRef(0),o=a.useMemo(()=>(0,H.s)(a=>{let s=++n.current;i(!0);let o=new TaskController({priority:"user-visible"});scheduler.postTask(()=>i(!0),{signal:o.signal,delay:300}).catch(()=>{});let l=e.getObject(a);l&&t({status:"searching",results:[{object:l,matches:[{value:a,property:"id",isExact:!0}]}]}),e.getSearch(r).then(e=>e.searchWithText(a)).then(e=>{o.abort(),s===n.current&&t({status:"success",results:e})}).catch(e=>{console.error(e),o.abort(),s===n.current&&t({status:"error",error:e})})},200),[e,r,t,i]);return a.useCallback(e=>0===e.length?t({status:"initial"}):o(e),[o,t])}(),{setKeyboardNavigationElement:o}=(0,eQ.M3)({path:[0,0],id:"input"});return(0,i.jsx)("input",{ref:t=>{o(t),e.current=t},type:"text",placeholder:r,className:"search_bar--searchBar--qnpUm",onChange:e=>n(e.target.value),onFocus:()=>t(!0)})}function eZ({children:e}){return(0,i.jsx)("div",{className:A.s.absolute.zIndexModal.colorBg.b1.colorBorder.mt2.overflowAuto.$,style:{maxHeight:450,minWidth:500,boxShadow:"0px 2px 14px var(--color-shadow, rgba(0, 0, 0, 0.15))"},children:e})}function e0({searchResults:e,selectResult:t}){return(0,i.jsx)(eZ,{children:e.map((e,r)=>(0,i.jsx)(e2,{result:e,index:r,onClick:()=>t(e)},e.object.id))})}function e1({text:e}){return(0,i.jsx)(eZ,{children:(Array.isArray(e)?e:[e]).map((e,t)=>(0,i.jsx)("div",{className:A.s.colorBg.colorTextSecondary.px8.py4.$,children:e},t))})}function e2({result:e,index:t,onClick:r}){let{object:n,matches:s}=e,{displayProperties:o}=n,{setKeyboardNavigationElement:l,keyboardNavigationItem:d,isFauxFocused:c}=(0,eQ.M3)({path:[1,t],id:n.id});return a.useEffect(()=>{d&&0===t&&d.fauxFocus()},[d,t]),(0,i.jsx)("button",{ref:l,className:eq()(A.s.block.wFull.px4.py8.colorText.flex.itemsCenter.alignLeft.$,"search_bar--searchResult--0iOvc",c&&"search_bar--fauxFocus--BYHwu"),onClick:r,children:(0,i.jsxs)(M.Y,{spacing:4,children:[(0,i.jsx)(ed.IV,{badges:o.leftBadges}),(0,i.jsx)(ec.nK,{id:n.displayProperties.primaryId}),(0,i.jsx)(eX.R,{className:A.s.overflowHidden.$,text:o.name}),(0,i.jsx)(M.M,{}),s.filter(({property:e})=>!["id","guid","name","type","phase"].includes(e)).map(({property:e,value:t},r)=>(0,i.jsxs)(M.Y,{spacing:4,width:"hug-contents",children:[(0,i.jsxs)("div",{children:[e,":"]}),(0,i.jsx)("div",{children:t})]},r))]})})}var e3=r(652539);function e5({children:e}){return(0,i.jsx)("div",{className:A.s.colorBorder.px8.py4.bb1.bSolid.$,children:(0,i.jsx)(M.Y,{children:e})})}function e4(e){let t={className:"toolbar_components--iconButton--1-XNe",children:(0,i.jsx)(e3.B,{svg:e.svg}),title:e.label,"aria-label":e.label};return"href"in e?(0,i.jsx)("a",{...t,href:e.href,target:"blank"}):(0,i.jsx)("button",{...t,onClick:e.onClick,disabled:e.disabled})}var e7=r(129503),e8=r(718668);function e6({searchRef:e}){let[t,r]=(0,s.fp)(_.jI),[n,l]=(0,s.fp)(_.JN),d=!!a.useContext(_.H$).selectInApp,[c,u]=(0,s.fp)(Q),[p,h]=(0,s.fp)(_.bA),[f,g]=(0,s.fp)(et),m=(0,s.md)(er);return(0,i.jsxs)(e5,{children:[(0,i.jsx)(eY,{searchRef:e}),(0,i.jsxs)("select",{name:"filter-or-search",title:"Determines whether the text box searches or filters",onChange:e=>{u(e.target.value)},defaultValue:c,children:[(0,i.jsx)("option",{value:x.Y6.Search,children:"Search"}),(0,i.jsx)("option",{value:x.Y6.Filter,children:"Filter"})]}),(0,i.jsx)("select",{name:"sort",title:"Sets the left panel sort order",onChange:e=>{let t=e.target.value;o.az.trackDefinedEvent("figmascope.sort_order_change",{order:function(e){switch(e){case x.hX.Position:return"position";case x.hX.Name:return"name";case x.hX.Memory:return"memory";case x.hX.NodeId:return"node_id"}}(t)}),g(t)},defaultValue:f,children:m.map(e=>(0,i.jsxs)("option",{value:e,children:["Sort by ",e]},e))}),d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{name:"follow-selection",type:"checkbox",checked:p,onChange:e=>h(e.target.checked)}),(0,i.jsx)("label",{htmlFor:"follow-selection",children:"Follow"})]}),(0,i.jsx)(e4,{label:"Select Previous",onClick:()=>{r(),o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"button"})},disabled:!t,svg:e7.A}),(0,i.jsx)(e4,{label:"Select Next",onClick:()=>{l(),o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"button"})},disabled:!n,svg:e8.A}),(0,i.jsx)(eG,{})]})}var e9=r(815701),te=r(577693),tt=r(555013),tr=r(472207),ti=r(380980),ta=r(458609),tn=r(619883),ts=r(821527);function to({selectedObject:e,diffObject:t,onClose:r}){let a=(0,s.md)(S),[n,o]=(0,s.fp)(p.Oz);return(0,i.jsxs)(e5,{children:[e?n&&t?(0,i.jsx)(tc,{selectedObject:e,diffObject:t,diffState:n,setDiffState:o}):(0,i.jsx)(td,{object:e}):t?(0,i.jsx)(td,{object:t}):(0,i.jsx)(M.M,{}),a&&(0,i.jsx)(tu,{}),(0,i.jsx)(e4,{label:"Help",href:tr.e,svg:ti.A}),r&&(0,i.jsx)(e4,{label:"Close FigmaScope",onClick:r,svg:ts.A})]})}let tl=A.s.flex1.ml10.my4.$;function td({object:e}){return(0,i.jsx)("div",{className:tl,children:(0,i.jsx)("span",{className:A.s.fontSemiBold.$,children:e.displayProperties.longName})})}function tc({selectedObject:e,diffObject:t,diffState:r,setDiffState:a}){let n=(0,s.Xr)(_.AJ);return(0,i.jsxs)("div",{className:A.s.flex1.ml10.my4.$,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:A.s.colorTextSecondary.$,children:"Diffing "}),(0,i.jsx)("span",{className:A.s.fontSemiBold.$,children:e.displayProperties.longName}),(0,i.jsx)("span",{className:A.s.colorTextSecondary.$,children:" against "}),(0,i.jsx)("span",{className:A.s.fontSemiBold.$,children:t.displayProperties.longName})]}),r&&(0,i.jsx)("div",{className:A.s.colorTextSecondary.mt8.$,children:(0,i.jsxs)(M.Y,{spacing:8,width:"hug-contents",height:"hug-contents",verticalAlignItems:"start",children:[(0,i.jsxs)("span",{children:["Snapshot of"," ",(0,i.jsx)(tt.CY,{onClick:()=>n(r.object.id),className:A.s.colorTextFigjam.fontSemiBold.$,trusted:!0,children:r.object.displayProperties.name}),r.type===p.Lp.Tree&&" and full subtree"," was taken at"," ",r.time.toLocaleTimeString("en-US")]}),(0,i.jsx)(tt.CY,{onClick:()=>a({type:"refresh"}),className:A.s.colorTextDesign.$,trusted:!0,children:"Refresh"}),(0,i.jsx)(tt.CY,{onClick:()=>a({type:"clear"}),className:A.s.colorTextDanger.$,trusted:!0,children:"Finish"})]})})]})}function tu(){let[e,t]=(0,s.fp)(w),r=e.status===c.r.LOADING;return a.useEffect(()=>{t()},[t]),(0,i.jsx)(e4,{label:r?"Fetching scene graph validation failures":"Refetch scenegraph validation failures",onClick:t,svg:r?ta.A:tn.A})}var tp=r(171660);function th({children:e}){return(0,i.jsx)("div",{className:A.s.hFull.$,children:(0,i.jsxs)(M.Y,{direction:"vertical",width:"fill-parent",height:"fill-parent",padding:0,spacing:0,children:[(0,i.jsx)(tf,{}),e]})})}function tf(){let{name:e,metadata:t}=(0,s.md)(h.Cc);return(0,i.jsxs)(M.Y,{direction:"horizontal",width:"fill-parent",height:32,padding:8,spacing:32,backgroundColor:"toolbar",children:[e&&(0,i.jsx)(tp.E,{fontWeight:"bold",color:"toolbar",children:e}),t&&Object.entries(t).map(([e,t])=>t&&(0,i.jsxs)("span",{children:[(0,i.jsxs)(tp.E,{color:"toolbar-secondary",children:[e,": "]}),(0,i.jsx)(tp.E,{color:"toolbar",fontFamily:"monospace",fontWeight:"bold",children:t})]},e))]})}var tg=r(753639);let tm=a.memo(function({embedded:e=!1,emptyStateContent:t,onClose:r,appSelection:a,setAppSelection:n}){let o=(0,s.md)(h.lu);switch(o.status){case c.r.INIT:return t??(0,i.jsx)(O.zG,{});case c.r.LOADING:return(0,i.jsx)(O.zG,{});case c.r.FAILURE:return(0,i.jsx)(O.rf,{error:o.error});case c.r.SUCCESS:}if(0===o.value.primaryResource.rootObjects.length)return(0,i.jsx)(O.rf,{error:"No root objects found. This is likely a bug - please report in #figmascope."});let l=(0,i.jsx)(ty,{appSelection:a,setAppSelection:n,onClose:r});return e?l:(0,i.jsx)(th,{children:l})});function ty({onClose:e,appSelection:t,setAppSelection:r}){let f=a.useRef(null),g=a.useRef(null),{windowInnerWidth:m}=(0,l.l)(),[y,b]=(0,s.fp)(tb),[v,k]=(0,s.fp)(tv),[S,I]=(0,n.i)({onDrag(e){let t=e.clientX/m;b(`${(100*t).toFixed(2)}%`)}}),[x,O]=(0,n.i)({onDrag(e){let t=g.current;if(!t)return;let r=(e.clientX-t.getBoundingClientRect().left)/t.clientWidth;k(`${(100*r).toFixed(2)}%`)}}),N=(0,s.Xr)(_.jI),C=(0,s.Xr)(_.JN),T=a.useCallback(e=>{let t=f.current;document.activeElement!==t&&(e.keyCode===d.Uz.FORWARD_SLASH&&t?(t.focus(),e.preventDefault()):e.keyCode===d.Uz.BRACKET_LEFT?(o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"prev",source:"keyboard"}),N()):e.keyCode===d.Uz.BRACKET_RIGHT&&(o.az.trackDefinedEvent("figmascope.select_prev_next",{direction:"next",source:"keyboard"}),C()))},[N,C]),P=(0,s.md)(h.Cc);window.figmaScope=P,window.figmaScopeScene=P,function(e){let[t,r]=(0,s.fp)(w);t.status===c.r.SUCCESS&&e?.setSceneGraphValidationInfo?.(t.value),(0,a.useEffect)(()=>{r()},[r])}(P);let E=(0,s.md)(_.AJ),j=(0,s.md)(_.gg),F=(0,s.md)(p.tH);return(0,i.jsx)(_.q,{appSelection:t,setAppSelection:r,children:(0,i.jsxs)("div",{className:tg.zr,style:u.sx.if(S||x,{cursor:"ew-resize"}).$,onKeyDown:T,children:[(0,i.jsxs)("div",{className:tg.Pd,style:{width:y},children:[(0,i.jsx)(e6,{searchRef:f}),(0,i.jsxs)(e9.o,{className:tg._H,children:[(0,i.jsx)("div",{...I({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,i.jsx)(e_,{appSelection:t})]})]}),(0,i.jsxs)("div",{className:tg.io,children:[(0,i.jsx)(to,{selectedObject:j,diffObject:F,onClose:e}),(j||F)&&(0,i.jsxs)("div",{className:tg._t,ref:g,children:[(0,i.jsxs)(e9.o,{className:tg.S3,style:{width:v},children:[(0,i.jsx)("div",{...O({style:{position:"absolute",top:0,bottom:0,right:"-3px",width:"5px",gridArea:"center",cursor:"ew-resize",zIndex:9}})}),(0,i.jsx)(te.P,{panel:"middle",items:j?.rawProperties,diffItems:F?.rawProperties,extraItems:void 0},E)]}),(0,i.jsx)(e9.o,{className:tg.xK,children:(0,i.jsx)(te.P,{panel:"right",items:j?.computedProperties,diffItems:F?.computedProperties,extraItems:P.getAdditionalProperties?.(E)},E)})]})]})]})})}let tb=(0,x.Sv)("leftPanelWidth","35%"),tv=(0,x.Sv)("rightPanelWidth","50%")},727144:(e,t,r)=>{r.d(t,{f:()=>i});class i{constructor(){this.inFlightOperations=new Map}run(e,t){let r=this.inFlightOperations.get(e);if(r)return r;let i=(async()=>{try{return await t()}finally{this.inFlightOperations.delete(e)}})();return this.inFlightOperations.set(e,i),i}}},926899:(e,t,r)=>{r.d(t,{BP:()=>u,_J:()=>d,xO:()=>l});var i=r(547115),a=r(757751),n=r(520199),s=r(432099),o=r(401146);let l=(e,t)=>async r=>{if(!e){let e="Thread ID is required to upload tool result to blob store";return(0,n.fL)(new n.fC(e),"upload_to_blob_store",{fileKey:t}),{state:"uploadFailed",error:e}}let i=await o.M.uploadJsonBlobs(t,e,[r]);if(i.success){let a=i.resultItems[0];if(!a){let r="Blobstore upload succeeded but no result was returned";return(0,n.fL)(new n.fC(r),"upload_to_blob_store",{fileKey:t,threadId:e}),{state:"uploadFailed",error:r}}return(0,n.pF)("Uploaded tool result to blob store",a),{state:r.success?"success":"toolFailed",blobstoreContentKey:a.contentKey}}{let r=`Failed to upload tool result to blob store: ${i.error}`;return(0,n.fL)(new n.fC(r),"upload_to_blob_store",{fileKey:t,threadId:e}),{state:"uploadFailed",error:r}}},d=({enabled:e,fileKey:t,threadId:r,userFlow:a})=>async s=>{if(!e){let e="Chat SDK is disabled, we should not be trying to upload content to blobstore";return(0,n.fL)(new n.Tv(e),"upload_to_blob_store",{fileKey:t,threadId:r}),{success:!1,error:e}}let l=await a.measureDurationAsync("uploadContentToBlobstore",async e=>{let i=await o.M.uploadBlobs(t,r,s);return e.addContext({statusCode:i.success?"200":"500",aiChatThreadId:r}),i});if(!l.success)return(0,n.fL)(new n.Tv(`Failed to upload content to blobstore: ${l.error}`),"upload_to_blob_store",{fileKey:t,threadId:r,cause:l.error}),l;let d=l.resultItems.length,c=l.resultItems.filter(e=>e.entityAlreadyExisted).length;return(0,n.nH)(`Uploaded ${d} items to Blobstore (${c} already existed)`,l),a.addAction("uploadedToBlobstore",i.$b.INFO,{numUploaded:d,numAlreadyExisted:c}),l};async function c(e){let t,r;try{let i=await s.Ay.crossOriginGet(e,null,{responseType:"blob",retryCount:2});200===i.status?t=i.data:r=i.cause??Error(`Failed to fetch blob (${i.status}): ${i.data}`)}catch(e){r=e instanceof Error?e:Error(String(e))}return{blob:t,error:r}}let u=new a.XO(o.M,(e,t)=>(0,n.fL)(e,"ai_chat_blobstore_cache",t),c,n.nH)},989282:(e,t,r)=>{r.d(t,{q:()=>c});var i=r(547115),a=r(727144),n=r(520199),s=r(743072),o=r(442218),l=r(338052);let d=new a.f,c=(0,l.nh)(async e=>{let{fileKey:t,context:r,plan:a}=e,l="ai_assistant"===r?n.fC:n.Tv,c=a.planRecordId;if(!c){let e="No plan record id, cannot create thread";return(0,n.fL)(new l(e),"create_thread_record",{fileKey:t}),{status:"error",error:e}}let u=async()=>{let a=s.J.createVital(`${r}.chat_sdk.thread_creation_time`,{level:i.$b.INFO});a.start();let d=await (0,n.kA)(a,()=>o.NH.createThread({fileKey:t,planId:c,privacyMode:"code_chat"===r?"file":"user",nodeGuid:"code_chat"===r?e.isOldFile?"old_file":e.nodeGuid:void 0}));if(a.stop(),!d.success){let{statusCode:e,cause:r,errorData:i}=d,a=`ApiAiChat.createThread failed, status: ${e}`;return(0,n.fL)(new l(a),"create_thread_record",{fileKey:t,statusCode:e,cause:r,errorData:i}),{status:"error",error:a}}return d.data.meta.alreadyExists&&(0,n.fL)(new l("ApiAiChat.createThread succeeded but thread already exists"),"create_thread_record",{fileKey:t,threadId:d.data.meta.threadId}),{status:"created",threadId:d.data.meta.threadId,isOldFile:"code_chat"===r&&e.isOldFile}};if("code_chat"!==r)return await u();{let i=`${t}:${r}:${e.nodeGuid}`;return await d.run(i,u)}})},347692:(e,t,r)=>{if(r.d(t,{G:()=>a}),443==r.j)var i=r(612691);function a(e){return"org"===e.tier||"enterprise"===e.tier?(0,i.z)("make_chat_sdk_phase1_org"):"pro"===e.tier||"student"===e.tier?(0,i.z)("make_chat_sdk_phase1_pro"):(0,i.z)("make_chat_sdk_phase1_starter")}},318648:(e,t,r)=>{r.d(t,{qM:()=>w,bg:()=>k,cD:()=>I,th:()=>b,bz:()=>_,p:()=>S,sc:()=>v,dJ:()=>y,Sw:()=>m});var i=r(716976),a=r(405242),n=r(370012),s=r(400045),o=r(723584);let l=(e,t,r)=>{let i=t.safeParse(r);if(!i.success){let t=Object.keys(r);throw new s.T(`Failed to parse ${e} message part. Type: ${r.type}. Keys: ${t.join(", ")}. Error: ${i.error.message}`)}return i.data};var d=r(795033),c=r(520199),u=r(449572),p=r(211862),h=r(592726),f=r(59849);function g(e){return i.useMemo(()=>"errors"!==e.status?[]:e.errors.filter(e=>!e.retriable),[e.status,e.errors])}function m({isEnabled:e,fileKey:t,nodeGuid:r}){let a=(0,h.iZ)(),n=e&&t&&r&&a,s=(0,u.Rs)((0,f.Zrv)(n?{ownerId:t,nodeGuid:r}:null)),o=s.data?.nodeAiChatThreads?.[0]??null,l=g(s);return i.useEffect(()=>{e&&0!==l.length&&(0,c.fL)(new c.Tv("Errors occurred while querying Livegraph NodeAiChatThreadsView"),"nodeaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(l),fileKey:t,nodeGuid:r})},[e,l,t,r]),{threadId:o?.id??null,isOldFile:o?"old_file"===o.nodeGuid:null,subscriptionStatus:s.status,latestUserMessage:o?.latestUserMessage??null}}function y(e,t,r,a,n){let s=(0,u.Rs)((0,f.r3i)(e?{ownerId:e}:null)),o=g(s);i.useEffect(()=>{0!==o.length&&(0,c.fL)(new c.fC("Errors occurred while querying Livegraph FileAiChatThreadsView"),"fileaichatthreadsview_initial_view_fail",{subscriptionErrors:JSON.stringify(o),fileKey:e})},[o,e]);let l=s.data?.fileAiChatThreads?.[0]?.id??null,d="loaded"!==s.status,[p,h]=i.useState(null),m=p??l,y=e&&m?{ownerId:e,id:m}:null,v=(0,u.Rs)((0,f.A6w)(y)),k=v.data?.activeAiChatThread??null;return i.useEffect(()=>{if(!k||!m||n)return;let e=k.messages.map(b);h(e=>(e!==m&&(0,c.pF)(`Livegraph threadId updating: ${e} => ${m}`),m));let i=a();e.length>i.length+t&&((0,c.pF)("LiveGraph ActiveAiChatThread updating =>",e),r(e))},[k,a,r,m,t,n,h]),{threadId:n?null:m,setThreadId:h,isLoadingThreadId:d}}function b(e){let t=(e.parts??[]).map(({partType:e,contentPb:t,blobstoreContentKey:r})=>{if(!(0,a.pQ)(e))return(0,c.D5)(`Unknown message part type when converting Livegraph message to AiChatMessage: ${e}. This part will be ignored.`),null;let{type:i,...s}=(0,a.H)(e,t);return(0,n.N)({type:i,contentJson:s,blobstoreContentKey:r})}).filter(e=>null!==e);return function({role:e,content:t,...r}){return{...(()=>{switch(e){case"user":return{role:e,content:t.map(t=>l(e,o.Fd,t))};case"assistant":return{role:e,content:t.map(t=>l(e,o.G4,t))};case"tool":return{role:e,content:t.map(t=>l(e,o.iS,t))};case"system":return{role:e,content:t.map(t=>l(e,o.jV,t))};default:throw new s.T(`Unknown message role: ${e}`)}})(),...r}}({role:e.role,content:t,createdAtMs:e.createdAt.getTime(),clientId:e.clientId??void 0,userId:"user"in e?e.user?.id??void 0:void 0,guid:"nodeGuid"in e?e.nodeGuid??void 0:void 0,scenegraphSentAt:"scenegraphSentAt"in e?e.scenegraphSentAt??void 0:void 0})}function v({chatMessagesNode:e,disabled:t}){let r=(0,d.md)(p.ze),i=!t&&r&&e,{threadId:a,subscriptionStatus:n}=m({isEnabled:!!i,fileKey:r,nodeGuid:e?.guid||""}),s=!t&&i&&a,o=(0,u.Rs)((0,f.A6w)(s?{ownerId:r,id:a}:null),{enabled:!!s});return{thread:o.data?.activeAiChatThread??null,subscriptionStatus:o.status??n}}let k=100;function S({chatMessagesNode:e,disabled:t}){let r=(0,d.md)(p.ze),i=!t&&r&&e,{threadId:a,subscriptionStatus:n}=m({isEnabled:!!i,fileKey:r,nodeGuid:e?.guid||""}),s=(0,u.Rs)((0,f.nmx)(!t&&i&&a?{ownerId:r,id:a,firstPageSize:k}:null));return{thread:s.data?.activeAiChatThread??null,subscriptionStatus:s.status??n}}let w={numberOfMessages:0,lastMessageUpdatedAt:new Date(0),lastMessageId:""};function I(e){let t=e.length,r=e[t-1];return{numberOfMessages:t,lastMessageUpdatedAt:r?.updatedAt??new Date(0),lastMessageId:r?.id??""}}function _(e,t){return null!=e&&null!=t&&e.numberOfMessages===t.numberOfMessages&&e.lastMessageUpdatedAt.getTime()===t.lastMessageUpdatedAt.getTime()&&e.lastMessageId===t.lastMessageId}},948515:(e,t,r)=>{if(r.d(t,{A:()=>p,m:()=>u}),443==r.j)var i=r(250700);var a=r(667693),n=r(980852),s=r(188220),o=r(492221),l=r.n(o);if(443==r.j)var d=r(991783);var c=r(755444),u=(e=>(e.NO_CHANGES="noChanges",e.NOT_INITIALIZED="notInitialized",e.CANCELED="canceled",e.SUCCESS="success",e.FAILED="failed",e))(u||{});class p{constructor(e){this.lastRenderError=null,this.nextRenderError=null,this.lastRenderedParameters=null,this.nextRenderParameters=null,this.lastRenderedDependencies=null,this.nextRenderedDependencies=null,this.rendering=!1,this.queuedRenderItem=null,this.internalRenderCount=0,this.internalRenderWindowStart=Date.now(),this.sitesPreview=e}update(e,t){null===e?(this.nextRenderError=null,this.nextRenderParameters=null,this.nextRenderedDependencies=null):e instanceof Error?(this.nextRenderError=e,this.nextRenderParameters=null,this.nextRenderedDependencies=null):(this.nextRenderError=null,this.nextRenderParameters=e,this.nextRenderedDependencies=t??null)}async render(e){var t,r;let o=this.nextRenderError;if(e.onlyIfChanged&&o&&(t=this.lastRenderError)instanceof Error&&o instanceof Error&&t.name===o.name&&t.message===o.message&&t.stack===o.stack)return{type:"noChanges"};if(o)throw this.logAndAssertRendersInternally(o),this.lastRenderError=o,this.nextRenderError=null,o;let c=this.nextRenderParameters;if(!c)return{type:"notInitialized"};let u=this.nextRenderedDependencies;if(!u)return{type:"notInitialized"};let p=function(e,t){if(null===e||null===t)return e===t?new Set:new Set([null===e?"null->not-null":"not-null->null"]);let r=new Set;for(let i of l()([...Object.keys(e.primitives),...Object.keys(t.primitives)]))e.primitives[i]!==t.primitives[i]&&r.add(`primitives.${i}`);for(let i of l()([...Object.keys(e.pure),...Object.keys(t.pure)]))e.pure[i]!==t.pure[i]&&r.add(`pure.${i}`);for(let i of l()([...Object.keys(e.deepEqual),...Object.keys(t.deepEqual)]))(0,a.c2)(e.deepEqual[i],t.deepEqual[i])||r.add(`deepEqual.${i}`);return r}(this.lastRenderedParameters,c),h=null===(r=this.lastRenderedDependencies)||null===u?r!==u:!(0,a.c2)(r.deepEqual,u.deepEqual);if(e.onlyIfChanged&&0===p.size&&!h)return{type:"noChanges"};this.logAndAssertRendersInternally(p);let f=(0,n.getActiveTSSceneGraph)().get(c.primitives.nodeId);if(!f||!f.isAlive)throw Error("Node no longer exists in the scene");if(this.rendering)return this.cancelQueuedRender(),this.queuedRenderItem=this.queuedRenderItem??{options:e,deferred:(0,d.v)()},this.queuedRenderItem.deferred.promise;this.rendering=!0,e.onRenderStart?.({reason:this.lastRenderedParameters?"changed":"initial"});let g=(0,s.g)(),m=(0,i.N)().getSourceCodeHash(),y={...u.deepEqual.entrypoint,codeFileExportName:c.primitives.codeFileExportName||"default"};try{let e=await this.sitesPreview.renderComponent({...c.primitives,...c.deepEqual,...c.pure,entrypoint:y,codeBuildId:g});if(e.success)return{type:"success",codeBuildId:g,timedOut:e.timedOut??!1,isCachedPreview:"snapshot"===y.type,sourceCodeHash:m};return{type:"failed",codeBuildId:g,error:e.error,phase:e.phase,isCachedPreview:"snapshot"===y.type,sourceCodeHash:m}}catch(e){return{type:"failed",codeBuildId:g,error:e,phase:"render",isCachedPreview:"snapshot"===y.type,sourceCodeHash:m}}finally{if(this.lastRenderError=null,this.lastRenderedParameters=c,this.lastRenderedDependencies=u,this.rendering=!1,this.queuedRenderItem){let e=this.queuedRenderItem;this.queuedRenderItem=null,setTimeout(()=>{this.render(e.options).then(e.deferred.resolve).catch(e.deferred.reject)},0)}}}destroy(){this.cancelQueuedRender()}cancelQueuedRender(){this.queuedRenderItem&&(this.queuedRenderItem.deferred.resolve({type:"canceled"}),this.queuedRenderItem=null)}logAndAssertRendersInternally(e){if(!(0,c.IX)())return;e instanceof Error?console.debug(`[IframeRenderer]: error changed: ${e.message}`):console.debug(`[IframeRenderer]: parameters changed: ${Array.from(e).join(", ")}`);let t=Date.now(),r=t-this.internalRenderWindowStart;if(r>1e3){this.internalRenderCount=1,this.internalRenderWindowStart=t;return}this.internalRenderCount++,this.internalRenderCount<=10||(console.error(`[IframeRenderer] Excessive renders detected: ${this.internalRenderCount} renders in ${r}ms.`),this.internalRenderCount=0,this.internalRenderWindowStart=t)}}},939054:(e,t,r)=>{if(r.d(t,{w:()=>d}),443==r.j)var i=r(951002);var a=r(208265),n=r.n(a),s=r(901014),o=r(948515);let l=443==r.j?2404e3:null;class d{constructor({surface:e,codeLibraryFormat:t}){this.fileKey=null,this.firstLiveUpdate=!0,this.currentUpdate=null,this.isMakeEmptyAtLastSync=!0,this.usedCachedPreview=!1,this.nextTriggeredUpdateReason=null,this.surface=e,this.codeLibraryFormat=t}cancelCurrentUpdate(){this.resetCurrentUpdate()}markAsReady(e){this.fileKey=e}triggerReload(e){this.nextTriggeredUpdateReason=e}startSync({isMakeEmpty:e}){this.currentUpdate||(this.isMakeEmptyAtLastSync=e,this.currentUpdate={syncStartedAt:new Date,updateType:null,isMakeEmpty:e,syncTimeoutId:setTimeout(()=>{this.trackMetricFailure("sync-timeout"),this.resetCurrentUpdate()},l)})}startTriggeredUpdate({isCachedPreview:e,reason:t}){if(this.currentUpdate?.updateType)return;e&&(this.usedCachedPreview=!0);let r=this.nextTriggeredUpdateReason;this.nextTriggeredUpdateReason=null,this.currentUpdate={...this.currentUpdate,updateTriggeredAt:new Date,updateType:(()=>{if(e)return"initial-cached";if(this.firstLiveUpdate)return this.usedCachedPreview?"initial-transition-to-live":"initial-live";if(r)return r;switch(t){case"initial":return"hmr-triggered-reload";case"changed":return"bundle-change-triggered-rerender";default:return(0,i.S9)(t,null,"Unknown iframe render reason"),"hmr-triggered-reload"}})(),triggeredUpdateTimeoutId:setTimeout(()=>{this.trackMetricFailure("triggered-update-timeout"),this.resetCurrentUpdate()},3e4)},e||(this.firstLiveUpdate=!1)}completeTriggeredUpdate(e){if(this.currentUpdate&&this.currentUpdate?.updateType!=="hmr-triggered-update")switch(this.currentUpdate.sourceCodeHash=e.sourceCodeHash,e.type){case o.m.SUCCESS:this.flushCurrentUpdate({success:!0,hitRenderTimeout:e.timedOut??!1,failedStep:void 0},{completedAt:new Date});break;case o.m.FAILED:switch(e.phase){case"import":"Failed to fetch"===e.error.message?this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"network",errorMessage:e.error.message},{completedAt:new Date}):this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"build",errorMessage:e.error.message},{completedAt:new Date});break;case"render":this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"render"},{completedAt:new Date});break;default:(0,i.S9)(e.phase,null,"Unknown iframe render result phase"),this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"unknown"},{completedAt:new Date})}break;default:(0,i.S9)(e,null,"Unknown iframe render result type")}}startHMRUpdate(){this.currentUpdate?.updateType||(this.currentUpdate={...this.currentUpdate,updateType:"hmr-triggered-update",hmrUpdateTimeoutId:setTimeout(()=>{this.flushCurrentUpdate({success:!0,hitRenderTimeout:!1,failedStep:void 0},{completedAt:this.currentUpdate?.hmrCompletedAt??new Date})},1e3)})}completeHMRUpdate(){this.currentUpdate?.updateType==="hmr-triggered-update"&&(this.currentUpdate.hmrCompletedAt=new Date)}handleBuildError(e){this.currentUpdate?.updateType==="hmr-triggered-update"&&this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"build",errorMessage:e.message},{completedAt:new Date})}handleRuntimeError(e){this.currentUpdate?.updateType==="hmr-triggered-update"&&this.flushCurrentUpdate({success:!1,hitRenderTimeout:!1,failedStep:"render",errorMessage:e.message},{completedAt:new Date})}flushCurrentUpdate(e,{completedAt:t}){if(!this.currentUpdate)return;if(!this.currentUpdate.updateType){this.trackMetricFailure("missing-update-type"),this.resetCurrentUpdate();return}let r=this.currentUpdate.syncStartedAt?t.getTime()-this.currentUpdate.syncStartedAt.getTime():this.currentUpdate.updateTriggeredAt?t.getTime()-this.currentUpdate.updateTriggeredAt.getTime():this.currentUpdate.hmrCompletedAt?t.getTime()-this.currentUpdate.hmrCompletedAt.getTime():0,a=(()=>{switch(this.currentUpdate.updateType){case"initial-cached":return"initial-cached";case"initial-live":return"initial-live";case"hmr-triggered-update":return"hmr-update";case"hmr-triggered-reload":case"user-triggered-reload":case"user-error-triggered-reload":case"error-recovery-triggered-reload":case"bundle-change-triggered-rerender":case"initial-transition-to-live":return"reload";default:return(0,i.S9)(this.currentUpdate.updateType,"reload","Unknown update type")}})();s.az.trackDefinedMetric("foundry.preview_update",{...e,updateType:this.currentUpdate.updateType,isMakeEmpty:this.currentUpdate.isMakeEmpty??this.isMakeEmptyAtLastSync,fileKey:this.fileKey??void 0,surface:this.surface,engine:"foundry",codeLibraryFormat:this.codeLibraryFormat.toString(),sourceCodeHash:this.currentUpdate.sourceCodeHash}),s.az.trackDefinedMetric("foundry.preview_update_latency",{...n()(e,["success","hitRenderTimeout"]),updateType:a,isMakeEmpty:this.currentUpdate.isMakeEmpty??this.isMakeEmptyAtLastSync,fileKey:this.fileKey??void 0,surface:this.surface,engine:"foundry",codeLibraryFormat:this.codeLibraryFormat.toString(),durationMs:r??0}),this.resetCurrentUpdate()}trackMetricFailure(e){s.az.trackDefinedEvent("foundry.preview_update_tracking_failure",{fileKey:this.fileKey??void 0,surface:this.surface,reason:e,engine:"foundry",codeLibraryFormat:this.codeLibraryFormat.toString()})}resetCurrentUpdate(){this.currentUpdate?.hmrUpdateTimeoutId&&clearTimeout(this.currentUpdate.hmrUpdateTimeoutId),this.currentUpdate?.triggeredUpdateTimeoutId&&clearTimeout(this.currentUpdate.triggeredUpdateTimeoutId),this.currentUpdate?.syncTimeoutId&&clearTimeout(this.currentUpdate.syncTimeoutId),this.currentUpdate=null}}},129575:(e,t,r)=>{r.d(t,{KF:()=>g,YP:()=>m,di:()=>b,qD:()=>y});var i=r(716976),a=r(901574),n=r(926899),s=r(989282);if(443==r.j)var o=r(347692);var l=r(318648),d=r(520199),c=r(211862),u=r(808242);if(443==r.j)var p=r(612691);if(443==r.j)var h=r(963433);if(443==r.j)var f=r(738591);function g(e,t){let r=m({overrideCodeLibraryNode:e===a.lV.FIGMAKE?t:null,disabled:e!==a.lV.FIGMAKE}),i=y({codeFileNode:e===a.lV.CODE_IN_SITES?t:null,disabled:e!==a.lV.CODE_IN_SITES}),n=b({codeFileNode:e===a.lV.FIGMAKE_IN_DESIGN?t:null,disabled:e!==a.lV.FIGMAKE_IN_DESIGN});switch(e){case a.lV.FIGMAKE:return r;case a.lV.CODE_IN_SITES:return i;case a.lV.FIGMAKE_IN_DESIGN:return n;default:throw Error(`Unsupported feature type: ${e}`)}}function m({overrideCodeLibraryNode:e,disabled:t}){let{codeLibraryInstance:r}=(0,h.oA)(),g=t?null:void 0!==e?e:r,m=(0,c.q5)(),y=m?.key??null,b=!!m?.canEdit;i.useEffect(()=>{y&&n.BP.clearCacheIfFileKeyChanged(y)},[y]);let{status:v,data:k}=(0,u.Vc)(y),S="loaded"===v,w=(0,f.gO)(g),I=!!(S&&k&&(0,o.G)(k)),{chatSdkState:_,chatSdkStatus:x}=function({fileKey:e,userCanEditFile:t,shouldQueryChatSdkState:r,chatMessagesNode:a,plan:n,nodeSource:o}){let c=i.useRef(!1),u=a?.guid||"",{threadId:p,isOldFile:h,subscriptionStatus:f}=(0,l.Sw)({isEnabled:!!(r&&e&&u),fileKey:e,nodeGuid:u}),g=h??o.getMessages().length>0,m=i.useRef(e),y=i.useRef(u),[b,v]=i.useState({threadId:p,isOldFile:g,errorOnCreateThread:!1}),k=null!==p&&(p!==b?.threadId||g!==b?.isOldFile),S=e!==m.current||u!==y.current;(k||S)&&(m.current=e,y.current=u,v({threadId:p,isOldFile:g,errorOnCreateThread:!1}));let w=e&&u&&"loaded"===f&&n&&r,I=w&&!t&&null===p;return w&&null===p&&t&&!c.current&&(c.current=!0,(0,s.q)({context:"code_chat",fileKey:e,plan:n,nodeGuid:u,isOldFile:g}).then(e=>{if("error"===e.status&&v({threadId:null,isOldFile:null,errorOnCreateThread:!0}),"created"===e.status){let{threadId:t,isOldFile:r}=e;(0,d.nH)(`Figmake AiChatThread created, id: ${t}, isOldFile?: ${r}`),v({threadId:t,isOldFile:r,errorOnCreateThread:!1})}})),i.useMemo(()=>{let{threadId:e,isOldFile:t,errorOnCreateThread:r}=b,i=f;return(r?i="errors":I&&(i="disabled"),e&&null!=t)?{chatSdkState:{threadId:e,isOldFile:t},chatSdkStatus:i}:{chatSdkState:void 0,chatSdkStatus:i}},[b,f,I])}({fileKey:y,userCanEditFile:b,chatMessagesNode:g,plan:k,shouldQueryChatSdkState:I,nodeSource:w}),O=I&&"errors"!==x&&"disabled"!==x,N=(0,f.eW)(g,y,_?.threadId??null),C=O&&(0,p.z)("make_chat_sdk_read")&&(!_?.isOldFile||(0,p.z)("make_chat_sdk_read_old_files"))&&((0,p.z)("make_chat_sdk_read_pagination")||w.getMessages().length<100);return i.useMemo(()=>{let e=C?N:w,t=[w];O&&t.push(N);let r=!!(S&&g&&(!O||_));return new a.F1({readingSource:e,writingSinks:t,isInitialized:r,node:g,chatSdkState:_,chatSdkPhase1Enabled:O,nodeChatSource:w})},[g,w,N,C,_,O,S])}function y({codeFileNode:e,disabled:t}){let r=t?null:e,n=(0,f.gO)(r);return i.useMemo(()=>new a.F1({readingSource:n,writingSinks:[n],node:r,chatSdkPhase1Enabled:!1,isInitialized:!!r,nodeChatSource:n}),[n,r])}function b({codeFileNode:e,disabled:t}){let r=t?null:e,n=(0,f.gO)(r);return i.useMemo(()=>new a.F1({readingSource:n,writingSinks:[n],node:r,chatSdkPhase1Enabled:!1,isInitialized:!!r,nodeChatSource:n}),[n,r])}},738591:(e,t,r)=>{r.d(t,{eW:()=>T,HL:()=>P,CQ:()=>O,gO:()=>x});var i=r(716976),a=r(901574),n=r(967325),s=r(400045),o=r(266808),l=r(723584),d=r(442498),c=r(951002);function u(e){let t={userId:e.userId,messageGuid:e.guid,createdAtMs:e.createdAtMs,scenegraphSentAt:e.scenegraphSentAt};switch(e.role){case"user":{let r=function(e,t){let r=(0,d.XL)(e,"code-chat-snapshot-restore");if(r){let e={type:"restore",plainText:"",codeSnapshot:{codeSnapshotKey:r.legacyS3CodeSnapshotKey,blobstoreContentKey:r.blobstoreContentKey},title:r.title},i=p(o.K$p.SYSTEM_MESSAGE,t);return i.textContent=JSON.stringify(e),i}let i=(0,d.XL)(e,"code-chat-manual-edit");if(i){let e={type:"manual_edit",plainText:"",changedFiles:i.changedFiles},r=p(o.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}let a=(0,d.XL)(e,"code-chat-duplicated-file");if(a){let e={type:"duplicated_file",plainText:a.plainText,fileKeyHash:a.fileKeyHash},r=p(o.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}let n=(0,d.XL)(e,"code-chat-deleted-chat-history");if(n){let e={type:"deleted_chat_history",plainText:"",userId:n.userId,timestamp:Number(n.timestamp)},r=p(o.K$p.SYSTEM_MESSAGE,t);return r.textContent=JSON.stringify(e),r}}(e,t);if(r)return r;let i={plainText:"",imports:[]};for(let t of e.content)switch(t.type){case"text":i.plainText=t.text;break;case"selected-node-ids":break;case"code-chat-model-config-version":i.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-library-keys":i.libraryKey=t.libraryKeys[0],i.libraryKeys=[...t.libraryKeys];break;case"code-chat-errors":i.errors=[...t.errors],i.hidden=!0,i.plainText="";break;case"cortex-request-uuid":i.requestUuid=t.requestUuid;break;case"code-chat-origin":i.origin=t.origin;break;case"code-chat-inspected-component":i.inspectedComponent={filePath:t.filePath,tagName:t.tagName};break;case"code-chat-inspected-library":i.inspectedLibrary={folderPath:t.folderPath,libraryName:t.libraryName};break;case"code-chat-snapshot-restore":case"code-chat-manual-edit":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":throw new s.T(`${t.type} should have been handled by maybeHandleNodeChatSystemMessage. Probably a bug`);case"code-chat-backfill-image-import":i.imports.push({type:"image",guid:t.guid,imageHash:t.imageHash});break;case"code-chat-backfill-code-import":i.imports.push({type:"node",guid:t.guid,communityAttribution:t.communityAttribution});break;case"code-chat-backfill-diff-import":i.imports.push({type:"diff",guid:t.guid,diffs:t.diffs});break;case"code-chat-backfill-inspected-element":{let{type:e,...r}=t;i.inspectedElement=r;break}case"code-chat-code-import-ref":i.imports.push(t.blobData?t.blobData:{type:"node",guid:"placeholder"});break;case"code-chat-image-import-ref":i.imports.push(t.blobData?t.blobData:{type:"image",guid:"placeholder"});break;case"code-chat-diff-import-ref":i.imports.push(t.blobData?t.blobData:{type:"diff",guid:"placeholder",diffs:""});break;case"code-chat-inspected-element-ref":i.inspectedElement={filePath:t.filePath,snippetStartLine:t.snippetStartLine,tagLine:t.tagLine,tagName:t.tagName,snippet:"",fileImports:"",componentHeader:""};break;case"image":case"jsx":throw new s.T(`Make does not support message part with type ${t.type}`);default:(0,c.xb)(t)}let n=p(o.K$p.USER_MESSAGE,t);return n.textContent=(0,a.J6)(i),n}case"assistant":{let r=[],i=[],n={plainText:""};for(let t of e.content)switch(t.type){case"text":throw new s.T("Cannot use 'text' for Code Chat assistant messages. Use 'code-chat-assistant-text' instead.");case"tool-call":r.push({toolCallId:t.toolCallId,toolName:t.toolName,argsJson:t.argsJSON});break;case"code-chat-legacy-assistant-tool-result":{let{type:e,...r}=t;i.push({...r});break}case"reasoning":t.signature?n.signedReasoning={text:t.text,signature:t.signature}:n.reasoning=[{text:t.text}];break;case"redacted-reasoning":n.redactedReasoning=t.data;break;case"code-chat-model-config-version":n.modelConfigVersion=t.modelConfigVersion;break;case"code-chat-assistant-text":n.plainText=t.text,n.mode=t.textMode;break;case"code-chat-assistant-code":case"code-chat-provider-metadata":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;case"code-chat-assistant-title":n.title=t.title;break;case"code-chat-legacy-s3-code-snapshot":{let e=n.codeSnapshot??{};n.codeSnapshot={...e,codeSnapshotKey:t.codeSnapshotKey,fileVersionId:"-1"};break}case"code-chat-code-snapshot":{let e=n.codeSnapshot??{};n.codeSnapshot={...e,blobstoreContentKey:t.blobstoreContentKey,fileVersionId:"-1"};break}default:(0,c.xb)(t)}let l=p(o.K$p.ASSISTANT_MESSAGE,t);return l.textContent=(0,a.J6)(n),l.toolCalls=r,l.toolResults=i,l}case"tool":{let r=[],i={plainText:""};for(let t of e.content)switch(t.type){case"tool-result":r.push({toolCallId:t.toolCallId,toolName:t.toolName,resultJson:t.resultJSON});break;case"code-chat-model-config-version":i.modelConfigVersion=t.modelConfigVersion;break;case"tool-result-ref":console.warn(`[chat-sdk] Part not implemented: ${t.type}`);break;default:(0,c.xb)(t)}let n=p(o.K$p.TOOL_MESSAGE,t);return n.textContent=(0,a.J6)(i),n.toolResults=r,n}case"system":throw new s.T("Chat SDK does not store system messages in the database (yet), we should never get here");default:(0,c.xb)(e)}}function p(e,t){let r=(0,a.ic)(e,t.userId??"placeholderUserId",()=>"placeholderMessageGuid");return void 0!==t.messageGuid&&(r.id=t.messageGuid),r.sentAt64=t.scenegraphSentAt??t.createdAtMs.toString(),r}let h=["code-chat-code-import-ref","code-chat-image-import-ref","code-chat-diff-import-ref"];async function f({aiChatMessages:e,partTypesToHydrate:t,blobstoreCache:r,threadId:i,fileKey:a,logWarn:n}){let s=[];for(let[r,i]of e.entries())for(let[e,a]of i.content.entries())(0,l.DN)(a)&&void 0===a.blobData&&t.includes(a.type)&&s.push({messageIndex:r,partIndex:e,refPart:structuredClone(a)});if(0===s.length)return{aiChatMessages:e,numHydratedRefParts:0};let o=s.map(({refPart:e})=>e.blobstoreContentKey),d=await r.fetchBlobs({fileKey:a,threadId:i,contentKeys:o});for(let{refPart:e}of s){let t;let r=d.get(e.blobstoreContentKey);if(!r)continue;try{t=JSON.parse(new TextDecoder().decode(r))}catch(t){n(`Failed to parse JSON for ${e.type} part, content key ${e.blobstoreContentKey}`);continue}let i=l.hE[e.type].shape.blobData.unwrap().safeParse(t);if(!i.success){n(`Invalid JSON schema for ${e.type} part, content key ${e.blobstoreContentKey}`);continue}e.blobData=i.data}return{aiChatMessages:function(e,t){let r={};for(let[t,i]of e.entries())r[t]=[...i.content];for(let{messageIndex:e,partIndex:i,refPart:a}of t)r[e][i]=a;return e.map((e,t)=>{let i=r[t];return i?{...e,content:i}:e})}(e,s),numHydratedRefParts:s.length}}var g=r(795033),m=r(926899),y=r(318648),b=r(520199),v=r(106170),k=r(835307),S=r(252285),w=r(612691);let I="null-hash",_=(0,S.H)({hash:I,messages:[]});function x(e){let t=(0,k.Fk)((e,t)=>t?.chatMessagesHash??I,e),r=e?.guid||"",[n,s]=(0,g.fp)(_(r)),o=(0,g.Pj)(),l=i.useMemo(()=>!!(e&&n.hash!==I),[n.hash,e]);i.useEffect(()=>{e&&t&&t!==n.hash&&s({hash:t,messages:e.chatMessages_DEPRECATED||[],pendingMessages:void 0})},[e,t,n.hash,s,r]);let d=i.useCallback(()=>{let e=o.get(_(r));return e.pendingMessages??e.messages??[]},[o,r]),c=i.useCallback(t=>{if(l&&e){let i=(0,a.BM)(t);(0,v.r)(()=>e.chatMessages_DEPRECATED=i);let n=o.get(_(r));o.set(_(r),{...n,pendingMessages:(0,a.BM)(t)})}},[l,e,o,r]),u=i.useCallback(t=>{l&&e&&c([...(0,a.BM)(d()),...t])},[c,d,l,e]),p=i.useCallback(t=>{l&&e&&c(t((0,a.BM)(d())))},[d,l,e,c]);return i.useMemo(()=>({getMessages:d,appendMessages:u,editMessages:p,isInitialized:l}),[d,u,p,l])}function O(e){return(0,g.md)(_(e)).hash!==I}let N=(0,S.H)({messages:[]}),C=(0,S.H)({messages:[]});function T(e,t,r){let a=function(e,t,r){let[a,n]=(0,g.fp)(N(e?.guid||"")),s=i.useRef(y.qM),o=((0,w.z)("make_chat_sdk_read")&&(0,w.z)("make_chat_sdk_read_pagination"))??!1,l=(0,w.z)("make_chat_sdk_read")&&e,{thread:d,subscriptionStatus:c}=(0,y.sc)({chatMessagesNode:e,disabled:!l||o}),{thread:u,subscriptionStatus:p}=(0,y.p)({chatMessagesNode:e,disabled:!l||!o}),v=o?u:d,k=o?"loaded"!==p:"loaded"!==c,S=i.useMemo(()=>!!(!l||v&&!k),[l,v,k]),I=i.useMemo(()=>o?[...u?.paginatedMessages??[]].reverse():d?.messages??[],[o,u,d]);i.useEffect(()=>{if(!S||!v||!t||!r)return;let e=(0,y.cD)(I);if(!(0,y.bz)(e,s.current)){let i=I.map(y.th);n({messages:i}),s.current=e,(0,b.nH)("[Pre-blobstore] Updated local cache with AiChatMessages",{thread:v,aiChatMessages:i}),f({aiChatMessages:i,partTypesToHydrate:h,blobstoreCache:m.BP,threadId:r,fileKey:t,logWarn:b.D5}).then(({aiChatMessages:t,numHydratedRefParts:r})=>{r>0?(n({messages:t}),s.current=e,(0,b.nH)("[Post-blobstore] Updated local cache with hydrated AiChatMessages",{aiChatMessages:t,numHydratedRefParts:r})):(0,b.nH)("No ref parts to hydrate, skipping re-render")}).catch(e=>{(0,b.nH)("Error hydrating chat messages from blobstore",e),s.current=y.qM})}},[v,S,n,I,t,r]);let _=i.useCallback(()=>a.messages,[a.messages]),x=i.useCallback(e=>[],[]),O=i.useCallback(()=>{},[]),C=i.useMemo(()=>{if(!o||!u)return;let e=u.paginatedMessages;return{loadNextPage:t=>{(0,b.nH)("Loading next page of messages",{count:t??y.bg}),e.loadNext(t??y.bg)},hasMore:e.hasNextPage(),isLoading:e.isLoadingNextPage,totalCount:void 0}},[o,u]);return i.useMemo(()=>({getMessages:_,editMessages:x,appendMessages:O,isInitialized:S,pagination:C}),[_,x,O,S,C])}(e,t,r),n=a.getMessages(),[s,o]=(0,g.fp)(C(e?.guid||"")),l=((0,w.z)("make_chat_sdk_read")&&(0,w.z)("make_chat_sdk_read_pagination"))??!1;i.useEffect(()=>{if(0===n.length)return;let e=n.map(u);o({messages:e}),(0,b.nH)("Set NodeChat cache with converted AiChatMessages",{aiChatMessages:n,convertedMessages:e,paginationEnabled:l})},[n,o,l]);let d=i.useCallback(()=>s.messages,[s.messages]),c=i.useCallback(e=>[],[]),p=i.useCallback(()=>{},[]),v=i.useMemo(()=>{if(!a.pagination)return;let e=n.length===s.messages.length;return{...a.pagination,isLoading:a.pagination.isLoading||!e}},[a.pagination,n.length,s.messages.length]);return i.useMemo(()=>({getMessages:d,editMessages:c,appendMessages:p,isInitialized:a.isInitialized,pagination:v}),[d,c,p,a.isInitialized,v])}function P(e){let t=e?.getMessages();return i.useMemo(()=>t?(0,n.Qf)((0,a.BM)(t),!1):[],[t])}},612691:(e,t,r)=>{r.d(t,{z:()=>n});var i=r(812714),a=r(743072);function n(e){let t=!!(0,i.kc)()[e];return a.J.trackFeatureFlagInView(e,t)}},703375:(e,t,r)=>{if(r.d(t,{b:()=>f,e:()=>c}),443==r.j)var i=r(951002);var a=r(638004),n=r(208265),s=r.n(n),o=r(725837),l=r(743072),d=r(249586),c=(e=>(e.EmbedKit="embed_kit",e.DesignPlayableMakesOnCanvas="design_playable_makes_on_canvas",e.DesignInSeparateTabPreview="design_in_separate_tab_preview",e.DesignInFloatingModalPreview="design_in_floating_modal_preview",e.MakeStandalone="make_standalone",e.SitesInFloatingModal="sites_in_floating_modal",e.Testing="testing",e))(c||{});let u={code_bundle_start:null,code_bundle_stop:null,preview_website_bundle_start:null,preview_website_bundle_stop:null,asset_generation_start:null,asset_generation_stop:null,render_start:null,render_stop:null,sandbox_create_start:null,sandbox_create_stop:null,files_patch_start:null,files_patch_stop:null,update_package_json_start:null,update_package_json_stop:null,install_dependencies_start:null,install_dependencies_stop:null,import_module_start:null,import_module_stop:null,cached_preview_urls_load_start:null,cached_preview_urls_load_stop:null,cached_preview_iframe_load_start:null,cached_preview_iframe_load_stop:null,flush_and_get_sequence_number_start:null,flush_and_get_sequence_number_stop:null},p={code_bundle_start:null,preview_website_bundle_start:null,asset_generation_start:null,render_start:null,sandbox_create_start:null,files_patch_start:null,update_package_json_start:null,install_dependencies_start:null,import_module_start:null,cached_preview_urls_load_start:null,cached_preview_iframe_load_start:null,flush_and_get_sequence_number_start:null};function h({start:e,stop:t}){return Math.max(0,e&&t&&t-e||0)}class f{constructor({isFoundry:e,surface:t,codeLibraryFormat:r}){this.initTime=null,this.userFlow=null,this.buildMetadata=null,this.loadMetadata={},this.syncMetadata={},this.durationVitalMap={...p},this.timingMap={...u},this.isFirstBuild=!0,this.isFoundry=e,this.surface=t,this.codeLibraryFormat=r.toString()}reset(){this.timingMap={...u},this.durationVitalMap={...p},this.initTime=null,this.userFlow=null,this.isFirstBuild=!1,this.buildMetadata=null,this.loadMetadata={}}record(e){this.initTime||(this.initTime=performance.now()),this.userFlow||(this.userFlow=l.J.startUserFlow({name:"component_preview",team:a.e.MAKE,context:{is_foundry:this.isFoundry,is_first_build:this.isFirstBuild,surface:this.surface.toString(),code_library_format:this.codeLibraryFormat}})),null===this.timingMap[e]&&(this.recordDurationVital(e),this.timingMap[e]=performance.now())}recordDurationVital(e){if(this.userFlow)switch(e){case"code_bundle_start":case"preview_website_bundle_start":case"asset_generation_start":case"render_start":case"sandbox_create_start":case"files_patch_start":case"update_package_json_start":case"install_dependencies_start":case"import_module_start":case"cached_preview_urls_load_start":case"cached_preview_iframe_load_start":case"flush_and_get_sequence_number_start":let t=this.userFlow.startDuration(e.replace("_start",""));t.addContext({is_foundry:this.isFoundry,is_first_build:this.isFirstBuild,surface:this.surface.toString(),code_library_format:this.codeLibraryFormat}),this.durationVitalMap[e]=t;break;case"code_bundle_stop":case"preview_website_bundle_stop":case"asset_generation_stop":case"render_stop":case"sandbox_create_stop":case"files_patch_stop":case"update_package_json_stop":case"install_dependencies_stop":case"import_module_stop":case"cached_preview_urls_load_stop":case"cached_preview_iframe_load_stop":case"flush_and_get_sequence_number_stop":let r=e.replace("_stop","_start");this.durationVitalMap[r]?.stop(),this.durationVitalMap[r]=null;break;default:(0,i.S9)(e,null)}}setBuildMetadata(e){this.buildMetadata=e}setLoadMetadata(e){this.loadMetadata={...this.loadMetadata,...e}}setSyncMetadata(e){this.syncMetadata={...this.syncMetadata,...e}}trackFigmentEvent(){let{code_bundle_start:e,code_bundle_stop:t,preview_website_bundle_start:r,preview_website_bundle_stop:i,asset_generation_start:a,asset_generation_stop:n,render_start:l,render_stop:c,sandbox_create_start:u,sandbox_create_stop:p,files_patch_start:f,files_patch_stop:g,update_package_json_start:m,update_package_json_stop:y,install_dependencies_start:b,install_dependencies_stop:v,import_module_start:k,import_module_stop:S,cached_preview_urls_load_start:w,cached_preview_urls_load_stop:I,cached_preview_iframe_load_start:_,cached_preview_iframe_load_stop:x,flush_and_get_sequence_number_start:O,flush_and_get_sequence_number_stop:N}=this.timingMap;if(!this.initTime){console.error("Component preview performance tracker init time not set. Unable to track figment event.");return}let C=o.D.getState(),T=(this.buildMetadata?.isBuildSuccessful||this.isFoundry?c:t)??performance.now();(0,d.ds)("code_component_preview_perf",C.openFile?.key,s()(C,["selectedView","fileByKey"]),{is_foundry:this.isFoundry,surface:this.surface.toString(),code_library_format:this.codeLibraryFormat,total_build_and_render_ms:h({start:this.initTime,stop:T}),bundle_code_ms:h({start:e,stop:t}),preview_website_bundle_ms:h({start:r,stop:i}),asset_generation_ms:h({start:a,stop:n}),render_ms:h({start:l,stop:c}),sandbox_create_ms:h({start:u,stop:p}),files_patch_ms:h({start:f,stop:g}),update_package_json_ms:h({start:m,stop:y}),install_dependencies_ms:h({start:b,stop:v}),import_module_ms:h({start:k,stop:S}),cached_preview_urls_load_ms:h({start:w,stop:I}),cached_preview_iframe_load_ms:h({start:_,stop:x}),flush_and_get_sequence_number_ms:h({start:O,stop:N}),npm_install_duration_ms:this.syncMetadata?.npmInstallDuration??0,is_first_build:this.isFirstBuild,is_build_successful:this.buildMetadata?.isBuildSuccessful,is_cached_preview_urls_load_successful:this.loadMetadata?.isCachedPreviewUrlsLoadSuccessful,cached_from_template_id:this.loadMetadata?.cachedFromTemplateId??null,cached_from_template_type:this.loadMetadata?.cachedFromTemplateType??null,newly_provisioned:this.loadMetadata?.newlyProvisioned,warm:this.loadMetadata?.warm??!1,error_message:this.buildMetadata?.errorMessage,bundle_js_length:this.buildMetadata?.bundleJsLength,bundle_css_length:this.buildMetadata?.bundleCssLength,total_library_code_files:this.buildMetadata?.totalCodeFiles,total_library_code_file_lines:this.buildMetadata?.totalCodeFileLines,total_library_image_imports:this.buildMetadata?.totalImageImports,source_code_hash:this.syncMetadata?.sourceCodeHash,is_sync_successful:this.syncMetadata?.isSyncSuccessful},{forwardToDatadog:!0}),this.userFlow?.end(),this.reset()}}},758813:(e,t,r)=>{r.d(t,{BE:()=>m,EY:()=>p,Er:()=>n,KH:()=>b,ME:()=>i,MF:()=>d,PD:()=>s,Rn:()=>o,U9:()=>u,UX:()=>a,X3:()=>f,bt:()=>l,dw:()=>h,mO:()=>y,mb:()=>g,pc:()=>c});let i=5e3,a=3,n=1e3,s=3e4,o=6e4,l=1e3,d=5e3,c=3,u=6e4,p=3,h=1e3,f=6e4,g=443==r.j?2e4:null,m="pnpm-lock.yaml",y="package.json",b=[m]},431146:(e,t,r)=>{r.d(t,{TT:()=>U,gR:()=>D,Ay:()=>K});var i=r(32085),a=r(250700),n=r(277867),s=r(542653),o=r(208821),l=r(317523),d=r(951002),c=r(221086),u=r(638004);class p extends Error{constructor(e="Operation timed out"){super(e),this.name="TimeoutError"}}var h=r(266808),f=r(170627),g=r(980852),m=r(812714),y=r(795033),b=r(901014),v=r(755444),k=r(550209),S=r(178623),w=r(20267),I=r(395556),_=r(616060),x=r(612953),O=r(581372),N=r(214249),C=r(581006),T=r(659390),P=r(758813),E=r(550527),j=r.n(E),F=r(518016),A=r.n(F),M=r(809565),L=r(826715);class R{constructor({entrypointsByIdentifier:e,originHost:t,abortSignal:r,limitRetries:i,codeLibraryFormat:a,perfTracker:n,onSyncQueued:s,onSyncPaused:l,onSyncResumed:d,onSyncFailure:c,onResponse:u}){this.syncedItemsByGuid={},this.queuedItemsByGuid=new Map,this.queuedMetadata=null,this.inFlightItems=[],this.processQueueTriggeredWhileInFlight=!1,this.isPaused=!1,this.pendingResolvers=[],this.sync=(e,t,r)=>{if(!this.addToQueue(e,t))return Promise.resolve();let i={};for(let[e,t]of Object.entries(r.filePathToMetadata))i[this.sanitizedPath(e)]=t;this.queuedMetadata={sourceCodeHash:r.sourceCodeHash,filePathToMetadata:i},this.onSyncQueued({queuePaused:this.isPaused});let a=new Promise((e,t)=>{this.pendingResolvers.push({resolve:e,reject:t})});return this.isPaused||this.processQueue(),a},this.pause=()=>{this.isPaused||(this.isPaused=!0,this.processQueue.cancel(),this.onSyncPaused({queuedItemsCount:this.queuedItemsByGuid.size}))},this.resume=()=>{if(!this.isPaused)return;this.isPaused=!1;let e=this.queuedItemsByGuid.size;e>0&&(this.processQueue(),this.processQueue.flush()),this.onSyncResumed({syncingItemsCount:e})},this.destroy=()=>{this.processQueue.cancel();let e=this.pendingResolvers.slice();this.pendingResolvers=[],e.forEach(({reject:e})=>e((0,o.N)()))},this.processQueue=j()(async()=>{if(this.inFlightItems.length>0){this.processQueueTriggeredWhileInFlight=!0;return}let e=this.pendingResolvers.slice();this.pendingResolvers=[];let t=()=>{e.forEach(({resolve:e})=>e())},r=Array.from(this.queuedItemsByGuid.values());if(this.queuedItemsByGuid.clear(),!r.length){t();return}let i=this.queuedMetadata?{...this.queuedMetadata}:null;this.queuedMetadata=null;try{this.inFlightItems=[...r];let e=await this.syncItems(r,i);try{this.onResponse(e,"sync")}catch(e){}this.syncedItemsByGuid={...this.syncedItemsByGuid,...A()(r,e=>e.entry.metadata.guid)},this.inFlightItems=[],t(),this.processQueueTriggeredWhileInFlight&&(this.processQueueTriggeredWhileInFlight=!1,this.isPaused||(this.processQueue(),this.processQueue.flush()))}catch(a){for(let e of r)this.tryAddItemToQueue(e);this.inFlightItems=[],this.queuedMetadata=this.queuedMetadata??i;let t=a instanceof Error?a:Error(String(a));(0,o.z)(a)||this.onSyncFailure(t),e.forEach(({reject:e})=>e(t))}},P.bt),this.entrypointsByIdentifier=e,this.originHost=t,this.abortSignal=r,this.limitRetries=i,this.perfTracker=n,this.codeLibraryFormat=a,this.onSyncQueued=s,this.onSyncPaused=l,this.onSyncResumed=d,this.onSyncFailure=c,this.onResponse=u}get isEmpty(){return 0===this.queuedItemsByGuid.size}addToQueue(e,t){let r=!1,i=e=>{if(!e.metadata.guid||!e.metadata.assetVersion||e.isInternal())return!1;let t=this.sanitizedPath(e.path);return!P.KH.includes(t)};for(let t of e.added){if(!i(t))continue;let e=this.tryAddItemToQueue({type:"upsert",entry:{path:this.sanitizedPath(t.path),contents:t.contents.toString(),metadata:{version:t.metadata.assetVersion,assetVersion:t.metadata.assetVersion,collaborativeVersion:t.metadata.collaborativeVersion,guid:t.metadata.guid,makeLibraryId:t.metadata.makeLibraryId}}});r||=e}for(let t of[...e.updated,...e.moved]){if(!i(t.new))continue;let e=this.tryAddItemToQueue({type:"upsert",entry:{path:this.sanitizedPath(t.new.path),contents:t.new.contents.toString(),metadata:{version:t.new.metadata.assetVersion,assetVersion:t.new.metadata.assetVersion,collaborativeVersion:t.new.metadata.collaborativeVersion,guid:t.new.metadata.guid,makeLibraryId:t.new.metadata.makeLibraryId}}});r||=e}for(let t of e.removed){if(!i(t))continue;let e=this.tryAddItemToQueue({type:"delete",entry:{path:this.sanitizedPath(t.path),metadata:{version:t.metadata.assetVersion,assetVersion:t.metadata.assetVersion,guid:t.metadata.guid}}});r||=e}return r}tryAddItemToQueue(e){let t=this.queuedItemsByGuid.get(e.entry.metadata.guid)??this.syncedItemsByGuid[e.entry.metadata.guid]??null;return!!this.shouldAcceptItem({currentItem:t,newItem:e})&&(this.queuedItemsByGuid.set(e.entry.metadata.guid,e),!0)}syncItems(e,t){return(0,c.OF)(async()=>{try{let r;(0,m.kc)().make_foundry_flush_before_sync?(this.perfTracker.record("flush_and_get_sequence_number_start"),r=await (0,L.c)(),this.perfTracker.record("flush_and_get_sequence_number_stop")):r=y.zl.get(M.J),this.perfTracker.record("files_patch_start"),this.perfTracker.setSyncMetadata({sourceCodeHash:t?.sourceCodeHash});let i=await S.Ay.foundry.sync({entrypointsByIdentifier:this.entrypointsByIdentifier,codeVfsEntryChanges:e,filePathToMetadata:t?.filePathToMetadata,originHost:this.originHost,codeLibraryFormat:this.codeLibraryFormat,sequenceNumber:r},{...(0,w.Ay)()},{abortSignal:this.abortSignal});return this.perfTracker.setSyncMetadata({npmInstallDuration:i.npmInstallDuration,isSyncSuccessful:!0}),i}catch(e){throw this.perfTracker.setSyncMetadata({isSyncSuccessful:!1}),e}finally{this.perfTracker.record("files_patch_stop")}},{times:this.limitRetries?P.EY:void 0,interval:P.dw,exponentialBackoff:!0,maxBackoff:P.U9,abortSignal:this.abortSignal})}shouldAcceptItem({currentItem:e,newItem:t}){return!e||"delete"!==e.type&&("delete"===t.type||0>(0,n.CL)(e.entry.metadata.assetVersion??e.entry.metadata.version,t.entry.metadata.assetVersion??t.entry.metadata.version))}sanitizedPath(e){return e.replace(/^\//,"")}}let J="timeout";function D(e="SandboxManager"){return(0,m.kc)().make_foundry_debug_logs?{info:(t,...r)=>{console.log(`[${e}] ${t}`,...r)},error:(t,...r)=>{console.error(`[${e}] ${t}`,...r)}}:{info:()=>{},error:()=>{}}}var V=(e=>(e.IDLE="IDLE",e.INITIALIZING_SANDBOX="INITIALIZING_SANDBOX",e.SANDBOX_READY="SANDBOX_READY",e.INITIALIZING_CODE="INITIALIZING_CODE",e.READY="READY",e.FAILED="FAILED",e))(V||{}),U=(e=>(e.CACHED_PREVIEW="CACHED_PREVIEW",e.FAILED="FAILED",e.PROVISIONING="PROVISIONING",e.REPROVISIONING="REPROVISIONING",e.PROVISIONED="PROVISIONED",e))(U||{});class K{constructor({originHost:e,fileKey:t,perfTracker:r,logger:n,previewUpdateTracker:s}){this.syncer=null,this.sandboxUrl=null,this._codeLibraryFormat=0,this._destroyed=!1,this.currentState="IDLE",this.syncingQueueStateInfo={currentSessionRunningAgentLoop:!1,otherSessionRunningAgentLoop:!1,designToCodeGenerating:!1},this.stateResolvers=new Map,this.attachHandlers=e=>{this.onStateChange=e.onStateChange},this.updateOtherSessionRunningAgentLoop=e=>{this.updateSyncingQueueState({otherSessionRunningAgentLoop:e})},this.updateDesignToCodeGenerating=e=>{this.updateSyncingQueueState({designToCodeGenerating:e})},this.initializeSandbox=()=>this.destroyed||"IDLE"!==this.currentState&&"FAILED"!==this.currentState?Promise.resolve():("IDLE"===this.currentState&&b.az.trackDefinedEvent("foundry.file_open",{fileKey:this.fileKey,sourceCodeHash:this.vfs.getSourceCodeHash(),codeLibraryFormat:this.codeLibraryFormat.toString()}),this.transitionTo("INITIALIZING_SANDBOX")),this.initializeCode=async({fromTemplate:e})=>{if(this.destroyed)return Promise.resolve();this.previewUpdateTracker.markAsReady(this.fileKey);let t=new Set(["READY","FAILED"]);return t.has(this.currentState)?Promise.resolve():(this.preloadCachedPreviewUrls({fromTemplate:e}).then(e=>{!e||t.has(this.currentState)||this.onStateChange?.({state:"CACHED_PREVIEW",cachedPreview:e})}).catch(()=>{}),"SANDBOX_READY"===await this.waitForState(["SANDBOX_READY","FAILED"]))?this.transitionTo("INITIALIZING_CODE"):void 0},this.destroy=()=>{this._destroyed=!0,this.resetSandbox()},this.waitForState=e=>{let t=new Set(Array.isArray(e)?e:[e]);return t.has(this.currentState)?Promise.resolve(this.currentState):new Promise(e=>{for(let r of t){let t=this.stateResolvers.get(r)||[];t.push(()=>{e(r)}),this.stateResolvers.set(r,t)}})},this.transitionTo=async(e,t)=>{let r=this.currentState;if(this.currentState=e,r===this.currentState)return;let i=this.stateResolvers.get(e);switch(i&&(i.forEach(e=>e()),this.stateResolvers.delete(e)),e){case"IDLE":case"SANDBOX_READY":break;case"INITIALIZING_SANDBOX":this.onStateChange?.({state:"IDLE"===r?"PROVISIONING":"REPROVISIONING"}),await this.doInitializeSandbox();break;case"INITIALIZING_CODE":await this.doInitializeCode();break;case"READY":this.sandboxUrl&&this.onStateChange?.({state:"PROVISIONED",url:this.sandboxUrl}),this.startKeepAlive();break;case"FAILED":{let e=t?.error??"Unknown error";this.onStateChange?.({state:"FAILED",error:e instanceof Error?e:Error(String(e))});break}default:(0,d.S9)(e,void 0,`Unknown state transition: ${e}`)}},this.resetSandbox=()=>{this.previewUpdateTracker.cancelCurrentUpdate(),this.sandboxUrl=null,this.stopListeningToVfsChanges(),this.abortController.abort(),this.syncer?.destroy(),this.syncer=null,this.unsubscribeChatMessageState?.(),this.abortController=new AbortController},this.doInitializeSandbox=async()=>{try{let e=await this.createSandbox();this.sandboxUrl=e.url}catch(e){(0,o.z)(e)||(this.transitionTo("FAILED",{error:e}),b.az.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_createSandbox",fileKey:this.fileKey,error:e instanceof Error?e.message:String(e)}));return}this.transitionTo("SANDBOX_READY")},this.doInitializeCode=async()=>{try{let e=this.vfs.listFiles();this.startListeningToVfsChanges(),this._codeLibraryFormat=g.getActiveTSSceneGraph().getLocalCodeLibraryOrNull()?.codeLibraryFormat??0,this.syncer=new R({entrypointsByIdentifier:this.vfs.getCodeIdentifierToEntrypoint(),originHost:this.originHost,abortSignal:this.abortController.signal,limitRetries:!this.uiFoundryEnabled,perfTracker:this.perfTracker,codeLibraryFormat:this.codeLibraryFormat,onSyncQueued:this.handleSyncQueued,onSyncPaused:this.handleSyncPaused,onSyncResumed:this.handleSyncResumed,onSyncFailure:this.handleSyncFailure,onResponse:e=>{this.handleSyncResponse(e)}}),this.updateSyncingQueueState({chatMessageState:y.zl.get(C.m1)}),this.unsubscribeChatMessageState=y.zl.sub(C.m1,this.handleChatMessageStateChange),await this.syncer.sync({added:e,removed:[],moved:[],updated:[]},i.P.LOCAL,this.getQueuedMetadata()),this.logger.info("Initial sync completed"),this.transitionTo("READY")}catch(e){if(this.stopListeningToVfsChanges(),!(0,o.z)(e))throw this.transitionTo("FAILED",{error:e}),b.az.trackDefinedEvent("foundry.sandbox_failed",{step:"initializeSandbox_sync",fileKey:this.fileKey,codeLibraryFormat:this.codeLibraryFormat.toString(),error:e instanceof Error?e.message:String(e)}),e}},this.handleVfsEntriesChange=async(e,t)=>{try{await this.syncer?.sync(e,t,this.getQueuedMetadata()),this.logger.info("VFS sync completed")}catch(e){this.logger.error("VFS sync failed:",e instanceof Error?e.message:String(e))}},this.handleChatMessageStateChange=()=>{this.updateSyncingQueueState({chatMessageState:y.zl.get(C.m1)})},this.handleSyncQueued=({queuePaused:e})=>{e||this.previewUpdateTracker.startSync({isMakeEmpty:(0,T.A)(this.vfs)})},this.handleSyncPaused=({queuedItemsCount:e})=>{e>0&&this.previewUpdateTracker.cancelCurrentUpdate()},this.handleSyncResumed=({syncingItemsCount:e})=>{e>0&&this.previewUpdateTracker.startSync({isMakeEmpty:(0,T.A)(this.vfs)})},this.handleSyncFailure=e=>{this.stopListeningToVfsChanges(),(0,o.z)(e)||(this.transitionTo("FAILED",{error:e}),b.az.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,a.N)().getSourceCodeHash(),success:!1,codeLibraryFormat:this.codeLibraryFormat.toString(),error:e.message}))},this.handleSandboxUrlResponse=(e,t)=>{if(this.sandboxUrl&&(!e.url||this.sandboxUrl!==e.url)){this.recreateSandbox();return}switch(t){case"sync":b.az.trackDefinedEvent("foundry.sync",{fileKey:this.fileKey,sourceCodeHash:(0,a.N)().getSourceCodeHash(),success:!0,codeLibraryFormat:this.codeLibraryFormat.toString()});break;case"keep-alive":b.az.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!0,codeLibraryFormat:this.codeLibraryFormat.toString()});break;default:(0,d.S9)(t,void 0,`Unknown source: ${t}`)}},this.startListeningToVfsChanges=()=>{this.vfs.on("entriesChanged",this.handleVfsEntriesChange)},this.stopListeningToVfsChanges=()=>{this.vfs.off("entriesChanged",this.handleVfsEntriesChange)},this.createSandbox=async()=>{let e=new AbortController,t=setTimeout(()=>{e.abort(J)},P.PD),r=(0,l.A)([this.abortController.signal,e.signal]);try{return await (0,c.OF)(async()=>{try{this.perfTracker.record("sandbox_create_start");let e=await S.Ay.foundry.sandbox({originHost:this.originHost},{...(0,w.Ay)(),trackingSessionId:(0,v.Ay)().tracking_session_id},{abortSignal:r});if("PROVISIONED"!==e.state)throw Error(`Sandbox not provisioned: ${e.state}`);return void 0!==e.newlyProvisioned&&this.perfTracker.setLoadMetadata({newlyProvisioned:e.newlyProvisioned}),void 0!==e.warm&&this.perfTracker.setLoadMetadata({warm:e.warm}),e}finally{this.perfTracker.record("sandbox_create_stop")}},{times:P.UX,interval:P.Er,exponentialBackoff:!0,maxBackoff:P.ME,abortSignal:r})}catch(e){if(r.reason===J)throw new p("Sandbox creation timed out");throw e}finally{clearTimeout(t)}},this.startKeepAlive=()=>{let e=setInterval(async()=>{try{if("visible"===document.visibilityState){let e=await S.Ay.foundry.keepAlive({},{...(0,w.Ay)(),trackingSessionId:(0,v.Ay)().tracking_session_id},{abortSignal:this.abortController.signal});this.handleSandboxUrlResponse(e,"keep-alive")}}catch(e){(0,o.z)(e)||b.az.trackDefinedEvent("foundry.keep_alive",{fileKey:this.fileKey,success:!1,codeLibraryFormat:this.codeLibraryFormatStr,error:e instanceof Error?e.message:String(e)})}},P.mb);this.abortController.signal.addEventListener("abort",()=>{clearInterval(e)})},this.preloadCachedPreviewUrls=async({fromTemplate:e})=>{if(!this.previewEnabled||(0,T.A)(this.vfs))return null;let t={fileKey:this.fileKey,surface:this.previewUpdateTracker.surface,codeLibraryFormat:this.codeLibraryFormatStr,isMakeEmpty:!1,templateId:e?.template.id,templateType:e?.type};try{this.perfTracker.record("cached_preview_urls_load_start");let r=await (()=>{if(e){if(!this.templatePreviewEnabled)return null;switch(e.type){case I.n.HubFile:return _.H.getCachedPreviewUrls({hubFileId:e.template.id});case I.n.TeamTemplate:return O.q.getCachedPreviewUrls({templateFileKey:e.template.file_key});case I.n.TeamTemplateLg:return O.q.getCachedPreviewUrls({templateFileKey:e.template.fileKey});default:(0,d.xb)(e)}}return x.Z.getCachedPreviewUrls({fileKey:this.fileKey,sourceCodeHash:(0,a.N)().getSourceCodeHash()})})();if(!r)return null;return b.az.trackDefinedEvent("foundry.preview_cache_load",{...t,hit:!0}),this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!0,cachedFromTemplateId:e?.template.id,cachedFromTemplateType:e?.type}),{jsUrl:r.data.meta.js_url,cssUrl:r.data.meta.css_url}}catch(r){return b.az.trackDefinedEvent("foundry.preview_cache_load",{...t,hit:!1}),this.perfTracker.setLoadMetadata({isCachedPreviewUrlsLoadSuccessful:!1,cachedFromTemplateId:e?.template.id,cachedFromTemplateType:e?.type}),null}finally{this.perfTracker.record("cached_preview_urls_load_stop")}},this.updateSyncingQueueState=({chatMessageState:e,otherSessionRunningAgentLoop:t,designToCodeGenerating:r})=>{this.syncingQueueStateInfo={otherSessionRunningAgentLoop:t??this.syncingQueueStateInfo.otherSessionRunningAgentLoop,currentSessionRunningAgentLoop:(()=>{if(!e)return this.syncingQueueStateInfo.currentSessionRunningAgentLoop;switch(e){case C.vO.IN_PROGRESS:case C.vO.AWAITING_COMMIT:return!0;case C.vO.IDLE:case C.vO.COMMITTED:case C.vO.ERROR:return!1;default:return(0,d.S9)(e,void 0,"Unknown chat message state"),!1}})(),designToCodeGenerating:r??this.syncingQueueStateInfo.designToCodeGenerating},this.syncingQueueStateInfo.otherSessionRunningAgentLoop||this.syncingQueueStateInfo.currentSessionRunningAgentLoop||this.syncingQueueStateInfo.designToCodeGenerating?this.syncer?.pause():this.syncer?.resume()},this.getQueuedMetadata=()=>{let e=this.vfs.listFiles(),t={};for(let r of e)t[r.path]={sha1Hash:r.metadata.sha1Hash,guid:r.metadata.guid,version:r.metadata.assetVersion};return{sourceCodeHash:this.vfs.getSourceCodeHash(),filePathToMetadata:t}},this.originHost=e,this.abortController=new AbortController,this.perfTracker=r,this.previewUpdateTracker=s,this.vfs=(0,a.N)(),this.fileKey=t,this.logger=n,this.previewEnabled=!!(0,m.kc)().make_foundry_cache_preview_client,this.templatePreviewEnabled=!!(0,m.kc)().make_foundry_template_cached_preview,this.uiFoundryEnabled=(0,N.t)()}get codeLibraryFormat(){return this._codeLibraryFormat}get codeLibraryFormatStr(){return this.codeLibraryFormat.toString()}get destroyed(){return this._destroyed}get initialized(){return"IDLE"!==this.currentState}recreateSandbox(){this.resetSandbox(),this.transitionTo("INITIALIZING_SANDBOX"),this.waitForState(["SANDBOX_READY","FAILED"]).then(e=>{"SANDBOX_READY"===e&&this.transitionTo("INITIALIZING_CODE")})}handleSyncResponse(e){this.handleSandboxUrlResponse(e,"sync"),this.updatePnpmLockFile(e)}updatePnpmLockFile(e){let{pnpmLockFileContents:t,foundryPackageJsonVersion:r}=e;if(!t||this.codeLibraryFormat<2)return;let i=(0,a.N)().getFileByPath(`/${P.mO}`),o=i?.metadata.assetVersion;if(o&&r&&0>=(0,n.CL)(r,o))return;let l=(0,s._J)(`/${P.BE}`);f.Hq.system("update-pnpm-lockfile",()=>{let e=(0,g.getActiveTSSceneGraph)();l?l.sourceCode=t:e.createNewCodeFile({path:P.BE,sourceCode:t,entryPoint:null,isEntrypointCodeFile:!1,onError:e=>{(0,k.$D)(u.e.MAKE,e)},createCodeComponent:!1}),h.glU?.commit()})}}},949299:(e,t,r)=>{r.d(t,{Ay:()=>k,Fq:()=>v,tT:()=>b});var i=r(716976),a=r(542653);if(443==r.j)var n=r(951002);var s=r(170627),o=r(795033),l=r(901014),d=r(915013),c=r(985416),u=r(939054);if(443==r.j)var p=r(107799);if(443==r.j)var h=r(533144);if(443==r.j)var f=r(703375);if(443==r.j)var g=r(963433);if(443==r.j)var m=r(48104);if(443==r.j)var y=r(431146);let b=1,v=(0,c.Wh)(()=>(0,o.eU)(null));function k({fileKey:e,isFoundryEnabled:t,surface:r}){let c=new URL((0,o.md)(m.jD)).host,k=(0,a.ft)(),S=(0,i.useRef)(new f.b({isFoundry:!0,surface:r,codeLibraryFormat:k})),w=(0,i.useRef)(new u.w({surface:r,codeLibraryFormat:k})),[I,_]=(0,i.useState)(!1),x=(0,g.oA)().codeLibraryInstance,O=(0,i.useMemo)(()=>!!x,[x]),{user:N}=(0,p.$W)(x?.guid),C=(0,d.KP)(),T=!!N&&N.sessionID!==C,P=(h.ne()?.size??0)>0,E=(0,i.useMemo)(()=>!I&&e&&t?new y.Ay({originHost:c,fileKey:e,logger:(0,y.gR)(),perfTracker:S.current,previewUpdateTracker:w.current}):null,[I,e,t,c]),j=(0,i.useCallback)(()=>{E&&E.recreateSandbox()},[E]);(0,i.useEffect)(()=>{t&&1>(0,a.ft)()&&s.l7.system("set-local-code-library-format",()=>{(0,a.lK)(1)})},[t]);let[F,A]=(0,o.fp)(v);(0,i.useEffect)(()=>{t||A(null)},[t,A]);let M=(0,i.useCallback)(t=>{switch(t.state){case y.TT.PROVISIONING:A({reinitialize:j,state:y.TT.PROVISIONING,perfTracker:S.current,previewUpdateTracker:w.current});break;case y.TT.CACHED_PREVIEW:A({reinitialize:j,state:y.TT.CACHED_PREVIEW,cachedPreview:t.cachedPreview,perfTracker:S.current,previewUpdateTracker:w.current});break;case y.TT.REPROVISIONING:A({reinitialize:j,state:y.TT.REPROVISIONING,perfTracker:S.current,previewUpdateTracker:w.current});break;case y.TT.PROVISIONED:A({reinitialize:j,state:y.TT.PROVISIONED,url:t.url,perfTracker:S.current,previewUpdateTracker:w.current});break;case y.TT.FAILED:E&&E.codeLibraryFormat<=b?(E.destroy(),_(!0),A(null),e&&l.az.trackDefinedEvent("foundry.fallback_to_esbuild",{fileKey:e,codeLibraryFormat:k.toString(),error:t.error.message})):A({reinitialize:j,state:y.TT.FAILED,error:t.error.message,perfTracker:S.current,previewUpdateTracker:w.current});break;default:(0,n.S9)(t,void 0,"Unknown sandbox state change")}},[E,e,A,k,j]),L=(0,i.useCallback)(e=>{E&&E.initializeCode(e)},[E]);return(0,i.useEffect)(()=>{E&&(E.attachHandlers({onStateChange:M}),E.updateOtherSessionRunningAgentLoop(T),E.updateDesignToCodeGenerating(P))},[E,T,P,M]),(0,i.useEffect)(()=>{E&&!E.initialized&&O&&(A({reinitialize:j,state:y.TT.PROVISIONING,perfTracker:S.current,previewUpdateTracker:w.current}),E.initializeSandbox())},[E,O,A,j]),(0,i.useEffect)(()=>()=>{E?.destroy()},[E]),(0,i.useMemo)(()=>null===F&&!I&&t?{sandbox:{reinitialize:j,state:y.TT.PROVISIONING,perfTracker:S.current,previewUpdateTracker:w.current},setCodeReady:L}:{sandbox:F,setCodeReady:L},[F,I,t,L,j])}},659390:(e,t,r)=>{if(r.d(t,{A:()=>n}),443==r.j)var i=r(927585);if(443==r.j)var a=r(742212);function n(e){return e.listFiles({onlyEntrypoints:i.z.ONLY_USED_ENTRYPOINTS,extensions:[".tsx",".ts",".jsx",".js"]}).some(e=>e.contents===a.jP)}},523657:(e,t,r)=>{r.d(t,{t:()=>n});var i=r(716976),a=r(104076);let n=(0,i.memo)(function(e){return(0,a.jsx)("svg",{width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",...e,"data-fpl-icon-size":"16",children:(0,a.jsx)("path",{fill:"var(--fpl-icon-color, var(--color-icon))",d:"M7.646 6.404a.5.5 0 0 1 .707 0l2.122 2.121a.5.5 0 0 1-.708.707L8 7.465 6.232 9.232a.5.5 0 0 1-.707-.707z"})})})},32085:(e,t,r)=>{var i;r.d(t,{P:()=>i}),function(e){e[e.LOCAL=0]="LOCAL",e[e.REMOTE=1]="REMOTE"}(i||(i={}))},967325:(e,t,r)=>{r.d(t,{EY:()=>d,Qf:()=>o,gG:()=>l});var i=r(901574),a=r(266808);if(443==r.j)var n=r(289172);var s=r(621592);function o(e,t){let r=(0,n.A)(e);return r?r.filter(e=>e.type!==a.K$p.TOOL_MESSAGE).reduce((e,r)=>{let n=r.type===a.K$p.ASSISTANT_MESSAGE,o=r.toolCalls.length>0,l=0===(0,i.H5)(r,t).plainText.length;if(n&&o&&l){let t=e[e.length-1];return t?.type===a.K$p.ASSISTANT_MESSAGE&&(t.toolCalls=s([...t.toolCalls,...r.toolCalls],"toolCallId")),e}return[...e,r]},[]):[]}function l(e){let{hidden:t,errors:r}=e;return!!t&&!!r&&r.length>0&&e.origin!==i.zm.FIX_ERRORS_BUTTON}function d(e){let t=e.slice().reverse().find(e=>e.type===a.K$p.USER_MESSAGE);return t?t.id:null}},742212:(e,t,r)=>{r.d(t,{Ar:()=>o,ft:()=>n,gB:()=>s,jP:()=>i,oA:()=>a});let i=443==r.j?`export default function App() {
  return (
    <div className="size-full flex items-center justify-center">
    </div>
  );
}`:null,a=443==r.j?`export default function App() {
  return (
    <div className="flex flex-wrap items-center justify-center size-full p-2 gap-1 bg-blue-600 text-white rounded-xl">
      <div className="text-md font-light truncate">
        {"Figma Make"}
      </div>
    </div>
  );
}`:null,n="/src/styles/tailwind.css",s="/vite.config.ts",o="/src/styles/index.css"},405242:(e,t,r)=>{r.d(t,{H:()=>o,pQ:()=>n});var i=r(400045),a=r(472846);function n(e){return a.g.includes(e)}function s(e,t){let r=(function(e){let t=a.l[e];if(null==t)throw new i.T(`Unknown message part type: ${e}. Did you add a new message part type to a proto file? Run \`pnpm --filter @figma/synapse-global generate-ai-chat-proto\` to regenerate Typescript bindings.`);return t})(e).decode(t);return{type:e,...r}}function o(e,t){try{return s(e,function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}(t))}catch(r){return s(e,function(e){let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2){let i=e.slice(r,r+2);t[r/2]=parseInt(i,16)}return t}(t))}}},472846:(e,t,r)=>{r.d(t,{g:()=>e2,l:()=>e3});var i=r(153379);function a(){return{selectedNodeIds:[]}}let n={encode(e,t=new i.fI){for(let r of e.selectedNodeIds)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),n=void 0===t?r.len:r.pos+t,s=a();for(;r.pos<n;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;s.selectedNodeIds.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return s},fromJSON:e=>({selectedNodeIds:o.Array.isArray(e?.selectedNodeIds)?e.selectedNodeIds.map(e=>o.String(e)):[]}),toJSON(e){let t={};return e.selectedNodeIds?.length&&(t.selectedNodeIds=e.selectedNodeIds),t},create:e=>n.fromPartial(e??{}),fromPartial(e){let t=a();return t.selectedNodeIds=e.selectedNodeIds?.map(e=>e)||[],t}},s={encode:(e,t=new i.fI)=>(""!==e.jsx&&t.uint32(10).string(e.jsx),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n={jsx:""};for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.jsx=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({jsx:null!=e.jsx?o.String(e.jsx):""}),toJSON(e){let t={};return""!==e.jsx&&(t.jsx=e.jsx),t},create:e=>s.fromPartial(e??{}),fromPartial(e){let t={jsx:""};return t.jsx=e.jsx??"",t}},o=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function l(){return{text:"",providerOptions:{}}}let d={encode:(e,t=new i.fI)=>(""!==e.text&&t.uint32(10).string(e.text),Object.entries(e.providerOptions).forEach(([e,r])=>{u.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=l();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.text=r.string();continue;case 2:{if(18!==e)break;let t=u.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({text:ee(e.text)?W.String(e.text):"",providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.text&&(t.text=e.text),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>d.fromPartial(e??{}),fromPartial(e){let t=l();return t.text=e.text??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function c(){return{key:"",value:""}}let u={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=c();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>u.fromPartial(e??{}),fromPartial(e){let t=c();return t.key=e.key??"",t.value=e.value??"",t}};function p(){return{textBlobstoreKey:"",providerOptions:{}}}let h={encode:(e,t=new i.fI)=>(""!==e.textBlobstoreKey&&t.uint32(10).string(e.textBlobstoreKey),Object.entries(e.providerOptions).forEach(([e,r])=>{g.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=p();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.textBlobstoreKey=r.string();continue;case 2:{if(18!==e)break;let t=g.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({textBlobstoreKey:ee(e.textBlobstoreKey)?W.String(e.textBlobstoreKey):"",providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.textBlobstoreKey&&(t.textBlobstoreKey=e.textBlobstoreKey),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>h.fromPartial(e??{}),fromPartial(e){let t=p();return t.textBlobstoreKey=e.textBlobstoreKey??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function f(){return{key:"",value:""}}let g={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=f();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>g.fromPartial(e??{}),fromPartial(e){let t=f();return t.key=e.key??"",t.value=e.value??"",t}};function m(){return{mimeType:void 0,providerOptions:{}}}let y={encode:(e,t=new i.fI)=>(void 0!==e.mimeType&&t.uint32(18).string(e.mimeType),Object.entries(e.providerOptions).forEach(([e,r])=>{v.encode({key:e,value:r},t.uint32(26).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=m();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 2:if(18!==e)break;n.mimeType=r.string();continue;case 3:{if(26!==e)break;let t=v.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({mimeType:ee(e.mimeType)?W.String(e.mimeType):void 0,providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(void 0!==e.mimeType&&(t.mimeType=e.mimeType),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>y.fromPartial(e??{}),fromPartial(e){let t=m();return t.mimeType=e.mimeType??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function b(){return{key:"",value:""}}let v={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=b();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>v.fromPartial(e??{}),fromPartial(e){let t=b();return t.key=e.key??"",t.value=e.value??"",t}};function k(){return{text:"",signature:void 0,providerOptions:{}}}let S={encode:(e,t=new i.fI)=>(""!==e.text&&t.uint32(10).string(e.text),void 0!==e.signature&&t.uint32(18).string(e.signature),Object.entries(e.providerOptions).forEach(([e,r])=>{I.encode({key:e,value:r},t.uint32(26).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=k();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.text=r.string();continue;case 2:if(18!==e)break;n.signature=r.string();continue;case 3:{if(26!==e)break;let t=I.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({text:ee(e.text)?W.String(e.text):"",signature:ee(e.signature)?W.String(e.signature):void 0,providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.text&&(t.text=e.text),void 0!==e.signature&&(t.signature=e.signature),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>S.fromPartial(e??{}),fromPartial(e){let t=k();return t.text=e.text??"",t.signature=e.signature??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function w(){return{key:"",value:""}}let I={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=w();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>I.fromPartial(e??{}),fromPartial(e){let t=w();return t.key=e.key??"",t.value=e.value??"",t}};function _(){return{providerOptions:{}}}let x={encode:(e,t=new i.fI)=>(Object.entries(e.providerOptions).forEach(([e,r])=>{N.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=_();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 2:{if(18!==e)break;let t=N.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>x.fromPartial(e??{}),fromPartial(e){let t=_();return t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function O(){return{key:"",value:""}}let N={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=O();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>N.fromPartial(e??{}),fromPartial(e){let t=O();return t.key=e.key??"",t.value=e.value??"",t}};function C(){return{data:"",providerOptions:{}}}let T={encode:(e,t=new i.fI)=>(""!==e.data&&t.uint32(10).string(e.data),Object.entries(e.providerOptions).forEach(([e,r])=>{E.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=C();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.data=r.string();continue;case 2:{if(18!==e)break;let t=E.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({data:ee(e.data)?W.String(e.data):"",providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.data&&(t.data=e.data),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>T.fromPartial(e??{}),fromPartial(e){let t=C();return t.data=e.data??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function P(){return{key:"",value:""}}let E={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=P();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>E.fromPartial(e??{}),fromPartial(e){let t=P();return t.key=e.key??"",t.value=e.value??"",t}};function j(){return{providerOptions:{}}}let F={encode:(e,t=new i.fI)=>(Object.entries(e.providerOptions).forEach(([e,r])=>{M.encode({key:e,value:r},t.uint32(18).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=j();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 2:{if(18!==e)break;let t=M.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>F.fromPartial(e??{}),fromPartial(e){let t=j();return t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function A(){return{key:"",value:""}}let M={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=A();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>M.fromPartial(e??{}),fromPartial(e){let t=A();return t.key=e.key??"",t.value=e.value??"",t}};function L(){return{toolCallId:"",toolName:"",providerOptions:{}}}let R={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),Object.entries(e.providerOptions).forEach(([e,r])=>{D.encode({key:e,value:r},t.uint32(34).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=L();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 4:{if(34!==e)break;let t=D.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?W.String(e.toolCallId):"",toolName:ee(e.toolName)?W.String(e.toolName):"",providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>R.fromPartial(e??{}),fromPartial(e){let t=L();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function J(){return{key:"",value:""}}let D={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=J();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>D.fromPartial(e??{}),fromPartial(e){let t=J();return t.key=e.key??"",t.value=e.value??"",t}};function V(){return{toolCallId:"",toolName:"",isError:void 0,providerOptions:{}}}let U={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),void 0!==e.isError&&t.uint32(32).bool(e.isError),Object.entries(e.providerOptions).forEach(([e,r])=>{H.encode({key:e,value:r},t.uint32(42).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=V();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 4:if(32!==e)break;n.isError=r.bool();continue;case 5:{if(42!==e)break;let t=H.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?W.String(e.toolCallId):"",toolName:ee(e.toolName)?W.String(e.toolName):"",isError:ee(e.isError)?W.Boolean(e.isError):void 0,providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),void 0!==e.isError&&(t.isError=e.isError),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>U.fromPartial(e??{}),fromPartial(e){let t=V();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.isError=e.isError??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function K(){return{key:"",value:""}}let H={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=K();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>H.fromPartial(e??{}),fromPartial(e){let t=K();return t.key=e.key??"",t.value=e.value??"",t}};function z(){return{toolCallId:"",toolName:"",argsJson:"",providerOptions:{}}}let B={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.argsJson&&t.uint32(26).string(e.argsJson),Object.entries(e.providerOptions).forEach(([e,r])=>{$.encode({key:e,value:r},t.uint32(34).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=z();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 3:if(26!==e)break;n.argsJson=r.string();continue;case 4:{if(34!==e)break;let t=$.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?W.String(e.toolCallId):"",toolName:ee(e.toolName)?W.String(e.toolName):"",argsJson:ee(e.argsJson)?W.String(e.argsJson):"",providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.argsJson&&(t.argsJson=e.argsJson),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>B.fromPartial(e??{}),fromPartial(e){let t=z();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.argsJson=e.argsJson??"",t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function G(){return{key:"",value:""}}let $={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=G();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>$.fromPartial(e??{}),fromPartial(e){let t=G();return t.key=e.key??"",t.value=e.value??"",t}};function q(){return{toolCallId:"",toolName:"",resultJson:"",isError:void 0,providerOptions:{}}}let X={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.resultJson&&t.uint32(26).string(e.resultJson),void 0!==e.isError&&t.uint32(32).bool(e.isError),Object.entries(e.providerOptions).forEach(([e,r])=>{Y.encode({key:e,value:r},t.uint32(42).fork()).join()}),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=q();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 3:if(26!==e)break;n.resultJson=r.string();continue;case 4:if(32!==e)break;n.isError=r.bool();continue;case 5:{if(42!==e)break;let t=Y.decode(r,r.uint32());void 0!==t.value&&(n.providerOptions[t.key]=t.value);continue}}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:ee(e.toolCallId)?W.String(e.toolCallId):"",toolName:ee(e.toolName)?W.String(e.toolName):"",resultJson:ee(e.resultJson)?W.String(e.resultJson):"",isError:ee(e.isError)?W.Boolean(e.isError):void 0,providerOptions:Z(e.providerOptions)?Object.entries(e.providerOptions).reduce((e,[t,r])=>(e[t]=String(r),e),{}):{}}),toJSON(e){let t={};if(""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.resultJson&&(t.resultJson=e.resultJson),void 0!==e.isError&&(t.isError=e.isError),e.providerOptions){let r=Object.entries(e.providerOptions);r.length>0&&(t.providerOptions={},r.forEach(([e,r])=>{t.providerOptions[e]=r}))}return t},create:e=>X.fromPartial(e??{}),fromPartial(e){let t=q();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.resultJson=e.resultJson??"",t.isError=e.isError??void 0,t.providerOptions=Object.entries(e.providerOptions??{}).reduce((e,[t,r])=>(void 0!==r&&(e[t]=W.String(r)),e),{}),t}};function Q(){return{key:"",value:""}}let Y={encode:(e,t=new i.fI)=>(""!==e.key&&t.uint32(10).string(e.key),""!==e.value&&t.uint32(18).string(e.value),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=Q();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.key=r.string();continue;case 2:if(18!==e)break;n.value=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({key:ee(e.key)?W.String(e.key):"",value:ee(e.value)?W.String(e.value):""}),toJSON(e){let t={};return""!==e.key&&(t.key=e.key),""!==e.value&&(t.value=e.value),t},create:e=>Y.fromPartial(e??{}),fromPartial(e){let t=Q();return t.key=e.key??"",t.value=e.value??"",t}},W=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function Z(e){return"object"==typeof e&&null!==e}function ee(e){return null!=e}let et={encode:(e,t=new i.fI)=>(""!==e.foo&&t.uint32(10).string(e.foo),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n={foo:""};for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.foo=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({foo:e1(e.foo)?e0.String(e.foo):""}),toJSON(e){let t={};return""!==e.foo&&(t.foo=e.foo),t},create:e=>et.fromPartial(e??{}),fromPartial(e){let t={foo:""};return t.foo=e.foo??"",t}};function er(){return{requestUuid:""}}let ei={encode:(e,t=new i.fI)=>(""!==e.requestUuid&&t.uint32(10).string(e.requestUuid),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=er();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.requestUuid=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({requestUuid:e1(e.requestUuid)?e0.String(e.requestUuid):""}),toJSON(e){let t={};return""!==e.requestUuid&&(t.requestUuid=e.requestUuid),t},create:e=>ei.fromPartial(e??{}),fromPartial(e){let t=er();return t.requestUuid=e.requestUuid??"",t}};function ea(){return{text:"",textMode:""}}let en={encode:(e,t=new i.fI)=>(""!==e.text&&t.uint32(10).string(e.text),""!==e.textMode&&t.uint32(18).string(e.textMode),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ea();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.text=r.string();continue;case 2:if(18!==e)break;n.textMode=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({text:e1(e.text)?e0.String(e.text):"",textMode:e1(e.textMode)?e0.String(e.textMode):""}),toJSON(e){let t={};return""!==e.text&&(t.text=e.text),""!==e.textMode&&(t.textMode=e.textMode),t},create:e=>en.fromPartial(e??{}),fromPartial(e){let t=ea();return t.text=e.text??"",t.textMode=e.textMode??"",t}};function es(){return{code:"",codeFilePath:""}}let eo={encode:(e,t=new i.fI)=>(""!==e.code&&t.uint32(10).string(e.code),""!==e.codeFilePath&&t.uint32(18).string(e.codeFilePath),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=es();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.code=r.string();continue;case 2:if(18!==e)break;n.codeFilePath=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({code:e1(e.code)?e0.String(e.code):"",codeFilePath:e1(e.codeFilePath)?e0.String(e.codeFilePath):""}),toJSON(e){let t={};return""!==e.code&&(t.code=e.code),""!==e.codeFilePath&&(t.codeFilePath=e.codeFilePath),t},create:e=>eo.fromPartial(e??{}),fromPartial(e){let t=es();return t.code=e.code??"",t.codeFilePath=e.codeFilePath??"",t}};function el(){return{modelConfigVersion:""}}let ed={encode:(e,t=new i.fI)=>(""!==e.modelConfigVersion&&t.uint32(10).string(e.modelConfigVersion),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=el();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.modelConfigVersion=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({modelConfigVersion:e1(e.modelConfigVersion)?e0.String(e.modelConfigVersion):""}),toJSON(e){let t={};return""!==e.modelConfigVersion&&(t.modelConfigVersion=e.modelConfigVersion),t},create:e=>ed.fromPartial(e??{}),fromPartial(e){let t=el();return t.modelConfigVersion=e.modelConfigVersion??"",t}};function ec(){return{title:""}}let eu={encode:(e,t=new i.fI)=>(""!==e.title&&t.uint32(10).string(e.title),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ec();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.title=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({title:e1(e.title)?e0.String(e.title):""}),toJSON(e){let t={};return""!==e.title&&(t.title=e.title),t},create:e=>eu.fromPartial(e??{}),fromPartial(e){let t=ec();return t.title=e.title??"",t}};function ep(){return{providerMetadataJson:""}}let eh={encode:(e,t=new i.fI)=>(""!==e.providerMetadataJson&&t.uint32(10).string(e.providerMetadataJson),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ep();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.providerMetadataJson=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({providerMetadataJson:e1(e.providerMetadataJson)?e0.String(e.providerMetadataJson):""}),toJSON(e){let t={};return""!==e.providerMetadataJson&&(t.providerMetadataJson=e.providerMetadataJson),t},create:e=>eh.fromPartial(e??{}),fromPartial(e){let t=ep();return t.providerMetadataJson=e.providerMetadataJson??"",t}},ef={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>ef.fromPartial(e??{}),fromPartial:e=>({})},eg={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>eg.fromPartial(e??{}),fromPartial:e=>({})},em={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>em.fromPartial(e??{}),fromPartial:e=>({})};function ey(){return{guid:"",imageHash:void 0}}let eb={encode:(e,t=new i.fI)=>(""!==e.guid&&t.uint32(10).string(e.guid),void 0!==e.imageHash&&t.uint32(18).string(e.imageHash),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ey();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.guid=r.string();continue;case 2:if(18!==e)break;n.imageHash=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({guid:e1(e.guid)?e0.String(e.guid):"",imageHash:e1(e.imageHash)?e0.String(e.imageHash):void 0}),toJSON(e){let t={};return""!==e.guid&&(t.guid=e.guid),void 0!==e.imageHash&&(t.imageHash=e.imageHash),t},create:e=>eb.fromPartial(e??{}),fromPartial(e){let t=ey();return t.guid=e.guid??"",t.imageHash=e.imageHash??void 0,t}};function ev(){return{guid:"",codeFiles:[],communityAttribution:void 0}}let ek={encode(e,t=new i.fI){for(let r of(""!==e.guid&&t.uint32(10).string(e.guid),e.codeFiles))ew.encode(r,t.uint32(18).fork()).join();return void 0!==e.communityAttribution&&e_.encode(e.communityAttribution,t.uint32(26).fork()).join(),t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ev();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.guid=r.string();continue;case 2:if(18!==e)break;n.codeFiles.push(ew.decode(r,r.uint32()));continue;case 3:if(26!==e)break;n.communityAttribution=e_.decode(r,r.uint32());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({guid:e1(e.guid)?e0.String(e.guid):"",codeFiles:e0.Array.isArray(e?.codeFiles)?e.codeFiles.map(e=>ew.fromJSON(e)):[],communityAttribution:e1(e.communityAttribution)?e_.fromJSON(e.communityAttribution):void 0}),toJSON(e){let t={};return""!==e.guid&&(t.guid=e.guid),e.codeFiles?.length&&(t.codeFiles=e.codeFiles.map(e=>ew.toJSON(e))),void 0!==e.communityAttribution&&(t.communityAttribution=e_.toJSON(e.communityAttribution)),t},create:e=>ek.fromPartial(e??{}),fromPartial(e){let t=ev();return t.guid=e.guid??"",t.codeFiles=e.codeFiles?.map(e=>ew.fromPartial(e))||[],t.communityAttribution=void 0!==e.communityAttribution&&null!==e.communityAttribution?e_.fromPartial(e.communityAttribution):void 0,t}};function eS(){return{codeFileGuid:"",fullFilePath:""}}let ew={encode:(e,t=new i.fI)=>(""!==e.codeFileGuid&&t.uint32(10).string(e.codeFileGuid),""!==e.fullFilePath&&t.uint32(18).string(e.fullFilePath),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eS();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.codeFileGuid=r.string();continue;case 2:if(18!==e)break;n.fullFilePath=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({codeFileGuid:e1(e.codeFileGuid)?e0.String(e.codeFileGuid):"",fullFilePath:e1(e.fullFilePath)?e0.String(e.fullFilePath):""}),toJSON(e){let t={};return""!==e.codeFileGuid&&(t.codeFileGuid=e.codeFileGuid),""!==e.fullFilePath&&(t.fullFilePath=e.fullFilePath),t},create:e=>ew.fromPartial(e??{}),fromPartial(e){let t=eS();return t.codeFileGuid=e.codeFileGuid??"",t.fullFilePath=e.fullFilePath??"",t}};function eI(){return{hubFileId:"",hubFileName:"",creatorName:""}}let e_={encode:(e,t=new i.fI)=>(""!==e.hubFileId&&t.uint32(10).string(e.hubFileId),""!==e.hubFileName&&t.uint32(18).string(e.hubFileName),""!==e.creatorName&&t.uint32(26).string(e.creatorName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eI();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.hubFileId=r.string();continue;case 2:if(18!==e)break;n.hubFileName=r.string();continue;case 3:if(26!==e)break;n.creatorName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({hubFileId:e1(e.hubFileId)?e0.String(e.hubFileId):"",hubFileName:e1(e.hubFileName)?e0.String(e.hubFileName):"",creatorName:e1(e.creatorName)?e0.String(e.creatorName):""}),toJSON(e){let t={};return""!==e.hubFileId&&(t.hubFileId=e.hubFileId),""!==e.hubFileName&&(t.hubFileName=e.hubFileName),""!==e.creatorName&&(t.creatorName=e.creatorName),t},create:e=>e_.fromPartial(e??{}),fromPartial(e){let t=eI();return t.hubFileId=e.hubFileId??"",t.hubFileName=e.hubFileName??"",t.creatorName=e.creatorName??"",t}};function ex(){return{guid:"",diffs:""}}let eO={encode:(e,t=new i.fI)=>(""!==e.guid&&t.uint32(10).string(e.guid),""!==e.diffs&&t.uint32(18).string(e.diffs),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ex();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.guid=r.string();continue;case 2:if(18!==e)break;n.diffs=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({guid:e1(e.guid)?e0.String(e.guid):"",diffs:e1(e.diffs)?e0.String(e.diffs):""}),toJSON(e){let t={};return""!==e.guid&&(t.guid=e.guid),""!==e.diffs&&(t.diffs=e.diffs),t},create:e=>eO.fromPartial(e??{}),fromPartial(e){let t=ex();return t.guid=e.guid??"",t.diffs=e.diffs??"",t}};function eN(){return{codeSnapshotKey:""}}let eC={encode:(e,t=new i.fI)=>(""!==e.codeSnapshotKey&&t.uint32(10).string(e.codeSnapshotKey),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eN();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.codeSnapshotKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({codeSnapshotKey:e1(e.codeSnapshotKey)?e0.String(e.codeSnapshotKey):""}),toJSON(e){let t={};return""!==e.codeSnapshotKey&&(t.codeSnapshotKey=e.codeSnapshotKey),t},create:e=>eC.fromPartial(e??{}),fromPartial(e){let t=eN();return t.codeSnapshotKey=e.codeSnapshotKey??"",t}},eT={encode:(e,t=new i.fI)=>t,decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t;for(;r.pos<a;){let e=r.uint32();if((7&e)==4||0===e)break;r.skip(7&e)}return{}},fromJSON:e=>({}),toJSON:e=>({}),create:e=>eT.fromPartial(e??{}),fromPartial:e=>({})};function eP(){return{errors:[]}}let eE={encode(e,t=new i.fI){for(let r of e.errors)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eP();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.errors.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({errors:e0.Array.isArray(e?.errors)?e.errors.map(e=>e0.String(e)):[]}),toJSON(e){let t={};return e.errors?.length&&(t.errors=e.errors),t},create:e=>eE.fromPartial(e??{}),fromPartial(e){let t=eP();return t.errors=e.errors?.map(e=>e)||[],t}};function ej(){return{libraryKeys:[]}}let eF={encode(e,t=new i.fI){for(let r of e.libraryKeys)t.uint32(10).string(r);return t},decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ej();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.libraryKeys.push(r.string());continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({libraryKeys:e0.Array.isArray(e?.libraryKeys)?e.libraryKeys.map(e=>e0.String(e)):[]}),toJSON(e){let t={};return e.libraryKeys?.length&&(t.libraryKeys=e.libraryKeys),t},create:e=>eF.fromPartial(e??{}),fromPartial(e){let t=ej();return t.libraryKeys=e.libraryKeys?.map(e=>e)||[],t}};function eA(){return{filePath:"",snippetStartLine:0,tagLine:0,tagName:""}}let eM={encode:(e,t=new i.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),0!==e.snippetStartLine&&t.uint32(16).int32(e.snippetStartLine),0!==e.tagLine&&t.uint32(24).int32(e.tagLine),""!==e.tagName&&t.uint32(34).string(e.tagName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eA();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.filePath=r.string();continue;case 2:if(16!==e)break;n.snippetStartLine=r.int32();continue;case 3:if(24!==e)break;n.tagLine=r.int32();continue;case 4:if(34!==e)break;n.tagName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({filePath:e1(e.filePath)?e0.String(e.filePath):"",snippetStartLine:e1(e.snippetStartLine)?e0.Number(e.snippetStartLine):0,tagLine:e1(e.tagLine)?e0.Number(e.tagLine):0,tagName:e1(e.tagName)?e0.String(e.tagName):""}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),0!==e.snippetStartLine&&(t.snippetStartLine=Math.round(e.snippetStartLine)),0!==e.tagLine&&(t.tagLine=Math.round(e.tagLine)),""!==e.tagName&&(t.tagName=e.tagName),t},create:e=>eM.fromPartial(e??{}),fromPartial(e){let t=eA();return t.filePath=e.filePath??"",t.snippetStartLine=e.snippetStartLine??0,t.tagLine=e.tagLine??0,t.tagName=e.tagName??"",t}};function eL(){return{filePath:"",snippetStartLine:0,tagLine:0,snippet:"",tagName:"",fileImports:void 0,componentHeader:void 0}}let eR={encode:(e,t=new i.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),0!==e.snippetStartLine&&t.uint32(16).int32(e.snippetStartLine),0!==e.tagLine&&t.uint32(24).int32(e.tagLine),""!==e.snippet&&t.uint32(34).string(e.snippet),""!==e.tagName&&t.uint32(42).string(e.tagName),void 0!==e.fileImports&&t.uint32(50).string(e.fileImports),void 0!==e.componentHeader&&t.uint32(58).string(e.componentHeader),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eL();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.filePath=r.string();continue;case 2:if(16!==e)break;n.snippetStartLine=r.int32();continue;case 3:if(24!==e)break;n.tagLine=r.int32();continue;case 4:if(34!==e)break;n.snippet=r.string();continue;case 5:if(42!==e)break;n.tagName=r.string();continue;case 6:if(50!==e)break;n.fileImports=r.string();continue;case 7:if(58!==e)break;n.componentHeader=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({filePath:e1(e.filePath)?e0.String(e.filePath):"",snippetStartLine:e1(e.snippetStartLine)?e0.Number(e.snippetStartLine):0,tagLine:e1(e.tagLine)?e0.Number(e.tagLine):0,snippet:e1(e.snippet)?e0.String(e.snippet):"",tagName:e1(e.tagName)?e0.String(e.tagName):"",fileImports:e1(e.fileImports)?e0.String(e.fileImports):void 0,componentHeader:e1(e.componentHeader)?e0.String(e.componentHeader):void 0}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),0!==e.snippetStartLine&&(t.snippetStartLine=Math.round(e.snippetStartLine)),0!==e.tagLine&&(t.tagLine=Math.round(e.tagLine)),""!==e.snippet&&(t.snippet=e.snippet),""!==e.tagName&&(t.tagName=e.tagName),void 0!==e.fileImports&&(t.fileImports=e.fileImports),void 0!==e.componentHeader&&(t.componentHeader=e.componentHeader),t},create:e=>eR.fromPartial(e??{}),fromPartial(e){let t=eL();return t.filePath=e.filePath??"",t.snippetStartLine=e.snippetStartLine??0,t.tagLine=e.tagLine??0,t.snippet=e.snippet??"",t.tagName=e.tagName??"",t.fileImports=e.fileImports??void 0,t.componentHeader=e.componentHeader??void 0,t}};function eJ(){return{filePath:"",tagName:""}}let eD={encode:(e,t=new i.fI)=>(""!==e.filePath&&t.uint32(10).string(e.filePath),""!==e.tagName&&t.uint32(18).string(e.tagName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eJ();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.filePath=r.string();continue;case 2:if(18!==e)break;n.tagName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({filePath:e1(e.filePath)?e0.String(e.filePath):"",tagName:e1(e.tagName)?e0.String(e.tagName):""}),toJSON(e){let t={};return""!==e.filePath&&(t.filePath=e.filePath),""!==e.tagName&&(t.tagName=e.tagName),t},create:e=>eD.fromPartial(e??{}),fromPartial(e){let t=eJ();return t.filePath=e.filePath??"",t.tagName=e.tagName??"",t}};function eV(){return{folderPath:"",libraryName:void 0}}let eU={encode:(e,t=new i.fI)=>(""!==e.folderPath&&t.uint32(10).string(e.folderPath),void 0!==e.libraryName&&t.uint32(18).string(e.libraryName),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eV();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.folderPath=r.string();continue;case 2:if(18!==e)break;n.libraryName=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({folderPath:e1(e.folderPath)?e0.String(e.folderPath):"",libraryName:e1(e.libraryName)?e0.String(e.libraryName):void 0}),toJSON(e){let t={};return""!==e.folderPath&&(t.folderPath=e.folderPath),void 0!==e.libraryName&&(t.libraryName=e.libraryName),t},create:e=>eU.fromPartial(e??{}),fromPartial(e){let t=eV();return t.folderPath=e.folderPath??"",t.libraryName=e.libraryName??void 0,t}};function eK(){return{origin:""}}let eH={encode:(e,t=new i.fI)=>(""!==e.origin&&t.uint32(10).string(e.origin),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eK();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.origin=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({origin:e1(e.origin)?e0.String(e.origin):""}),toJSON(e){let t={};return""!==e.origin&&(t.origin=e.origin),t},create:e=>eH.fromPartial(e??{}),fromPartial(e){let t=eK();return t.origin=e.origin??"",t}};function ez(){return{toolCallId:"",toolName:"",resultJson:""}}let eB={encode:(e,t=new i.fI)=>(""!==e.toolCallId&&t.uint32(10).string(e.toolCallId),""!==e.toolName&&t.uint32(18).string(e.toolName),""!==e.resultJson&&t.uint32(26).string(e.resultJson),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=ez();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.toolCallId=r.string();continue;case 2:if(18!==e)break;n.toolName=r.string();continue;case 3:if(26!==e)break;n.resultJson=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({toolCallId:e1(e.toolCallId)?e0.String(e.toolCallId):"",toolName:e1(e.toolName)?e0.String(e.toolName):"",resultJson:e1(e.resultJson)?e0.String(e.resultJson):""}),toJSON(e){let t={};return""!==e.toolCallId&&(t.toolCallId=e.toolCallId),""!==e.toolName&&(t.toolName=e.toolName),""!==e.resultJson&&(t.resultJson=e.resultJson),t},create:e=>eB.fromPartial(e??{}),fromPartial(e){let t=ez();return t.toolCallId=e.toolCallId??"",t.toolName=e.toolName??"",t.resultJson=e.resultJson??"",t}};function eG(){return{changedFilesJson:"",title:"",legacyS3CodeSnapshotKey:void 0}}let e$={encode:(e,t=new i.fI)=>(""!==e.changedFilesJson&&t.uint32(10).string(e.changedFilesJson),""!==e.title&&t.uint32(18).string(e.title),void 0!==e.legacyS3CodeSnapshotKey&&t.uint32(26).string(e.legacyS3CodeSnapshotKey),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eG();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.changedFilesJson=r.string();continue;case 2:if(18!==e)break;n.title=r.string();continue;case 3:if(26!==e)break;n.legacyS3CodeSnapshotKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({changedFilesJson:e1(e.changedFilesJson)?e0.String(e.changedFilesJson):"",title:e1(e.title)?e0.String(e.title):"",legacyS3CodeSnapshotKey:e1(e.legacyS3CodeSnapshotKey)?e0.String(e.legacyS3CodeSnapshotKey):void 0}),toJSON(e){let t={};return""!==e.changedFilesJson&&(t.changedFilesJson=e.changedFilesJson),""!==e.title&&(t.title=e.title),void 0!==e.legacyS3CodeSnapshotKey&&(t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey),t},create:e=>e$.fromPartial(e??{}),fromPartial(e){let t=eG();return t.changedFilesJson=e.changedFilesJson??"",t.title=e.title??"",t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey??void 0,t}};function eq(){return{plainText:"",fileKeyHash:""}}let eX={encode:(e,t=new i.fI)=>(""!==e.plainText&&t.uint32(10).string(e.plainText),""!==e.fileKeyHash&&t.uint32(18).string(e.fileKeyHash),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eq();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.plainText=r.string();continue;case 2:if(18!==e)break;n.fileKeyHash=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({plainText:e1(e.plainText)?e0.String(e.plainText):"",fileKeyHash:e1(e.fileKeyHash)?e0.String(e.fileKeyHash):""}),toJSON(e){let t={};return""!==e.plainText&&(t.plainText=e.plainText),""!==e.fileKeyHash&&(t.fileKeyHash=e.fileKeyHash),t},create:e=>eX.fromPartial(e??{}),fromPartial(e){let t=eq();return t.plainText=e.plainText??"",t.fileKeyHash=e.fileKeyHash??"",t}};function eQ(){return{userId:"",timestamp:""}}let eY={encode:(e,t=new i.fI)=>(""!==e.userId&&t.uint32(10).string(e.userId),""!==e.timestamp&&t.uint32(18).string(e.timestamp),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eQ();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.userId=r.string();continue;case 2:if(18!==e)break;n.timestamp=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({userId:e1(e.userId)?e0.String(e.userId):"",timestamp:e1(e.timestamp)?e0.String(e.timestamp):""}),toJSON(e){let t={};return""!==e.userId&&(t.userId=e.userId),""!==e.timestamp&&(t.timestamp=e.timestamp),t},create:e=>eY.fromPartial(e??{}),fromPartial(e){let t=eQ();return t.userId=e.userId??"",t.timestamp=e.timestamp??"",t}};function eW(){return{title:"",legacyS3CodeSnapshotKey:void 0,blobstoreContentKey:void 0}}let eZ={encode:(e,t=new i.fI)=>(""!==e.title&&t.uint32(10).string(e.title),void 0!==e.legacyS3CodeSnapshotKey&&t.uint32(18).string(e.legacyS3CodeSnapshotKey),void 0!==e.blobstoreContentKey&&t.uint32(26).string(e.blobstoreContentKey),t),decode(e,t){let r=e instanceof i.V5?e:new i.V5(e),a=void 0===t?r.len:r.pos+t,n=eW();for(;r.pos<a;){let e=r.uint32();switch(e>>>3){case 1:if(10!==e)break;n.title=r.string();continue;case 2:if(18!==e)break;n.legacyS3CodeSnapshotKey=r.string();continue;case 3:if(26!==e)break;n.blobstoreContentKey=r.string();continue}if((7&e)==4||0===e)break;r.skip(7&e)}return n},fromJSON:e=>({title:e1(e.title)?e0.String(e.title):"",legacyS3CodeSnapshotKey:e1(e.legacyS3CodeSnapshotKey)?e0.String(e.legacyS3CodeSnapshotKey):void 0,blobstoreContentKey:e1(e.blobstoreContentKey)?e0.String(e.blobstoreContentKey):void 0}),toJSON(e){let t={};return""!==e.title&&(t.title=e.title),void 0!==e.legacyS3CodeSnapshotKey&&(t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey),void 0!==e.blobstoreContentKey&&(t.blobstoreContentKey=e.blobstoreContentKey),t},create:e=>eZ.fromPartial(e??{}),fromPartial(e){let t=eW();return t.title=e.title??"",t.legacyS3CodeSnapshotKey=e.legacyS3CodeSnapshotKey??void 0,t.blobstoreContentKey=e.blobstoreContentKey??void 0,t}},e0=(()=>{if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw"Unable to locate global object"})();function e1(e){return null!=e}let e2=["selected-node-ids","jsx","text","text-ref","image-ref","reasoning","reasoning-ref","redacted-reasoning","redacted-reasoning-ref","tool-call-ref","tool-result-ref","tool-call-json-DO-NOT-USE-IN-PROD","tool-result-json-DO-NOT-USE-IN-PROD","figmake-test-part","cortex-request-uuid","code-chat-assistant-text","code-chat-assistant-code","code-chat-model-config-version","code-chat-assistant-title","code-chat-provider-metadata","code-chat-code-import-ref","code-chat-image-import-ref","code-chat-diff-import-ref","code-chat-backfill-image-import","code-chat-backfill-code-import","code-chat-backfill-diff-import","code-chat-legacy-s3-code-snapshot","code-chat-code-snapshot","code-chat-errors","code-chat-library-keys","code-chat-inspected-element-ref","code-chat-backfill-inspected-element","code-chat-inspected-component","code-chat-inspected-library","code-chat-origin","code-chat-legacy-assistant-tool-result","code-chat-manual-edit","code-chat-duplicated-file","code-chat-deleted-chat-history","code-chat-snapshot-restore"],e3={"selected-node-ids":n,jsx:s,text:d,"text-ref":h,"image-ref":y,reasoning:S,"reasoning-ref":x,"redacted-reasoning":T,"redacted-reasoning-ref":F,"tool-call-ref":R,"tool-result-ref":U,"tool-call-json-DO-NOT-USE-IN-PROD":B,"tool-result-json-DO-NOT-USE-IN-PROD":X,"figmake-test-part":et,"cortex-request-uuid":ei,"code-chat-assistant-text":en,"code-chat-assistant-code":eo,"code-chat-model-config-version":ed,"code-chat-assistant-title":eu,"code-chat-provider-metadata":eh,"code-chat-code-import-ref":ef,"code-chat-image-import-ref":eg,"code-chat-diff-import-ref":em,"code-chat-backfill-image-import":eb,"code-chat-backfill-code-import":ek,"code-chat-backfill-diff-import":eO,"code-chat-legacy-s3-code-snapshot":eC,"code-chat-code-snapshot":eT,"code-chat-errors":eE,"code-chat-library-keys":eF,"code-chat-inspected-element-ref":eM,"code-chat-backfill-inspected-element":eR,"code-chat-inspected-component":eD,"code-chat-inspected-library":eU,"code-chat-origin":eH,"code-chat-legacy-assistant-tool-result":eB,"code-chat-manual-edit":e$,"code-chat-duplicated-file":eX,"code-chat-deleted-chat-history":eY,"code-chat-snapshot-restore":eZ}},370012:(e,t,r)=>{r.d(t,{N:()=>c,t:()=>d});var i=r(400045),a=r(723584),n=r(472846),s=r(405242),o=r(839903);if(443==r.j)var l=r(951002);function d(e){let t=structuredClone(e);switch(t.type){case"text":case"reasoning":case"redacted-reasoning":return{...t,providerOptions:{}};case"selected-node-ids":case"jsx":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-text":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-origin":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-backfill-image-import":case"code-chat-backfill-diff-import":case"code-chat-backfill-inspected-element":return t;case"tool-call":{let{toolCallId:e,toolName:r,argsJSON:i,providerOptions:a}=t;return{type:"tool-call-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,argsJson:i,providerOptions:a??{}}}case"tool-result":{let{toolCallId:e,toolName:r,resultJSON:i,isError:a}=t;return{type:"tool-result-json-DO-NOT-USE-IN-PROD",toolCallId:e,toolName:r,resultJson:i,isError:a,providerOptions:{}}}case"tool-result-ref":{let{toolCallId:e,toolName:r,blobstoreContentKey:i,isError:a}=t;return{type:"tool-result-ref",toolCallId:e,toolName:r,isError:a,providerOptions:{}}}case"code-chat-backfill-code-import":{let{codeFiles:e,...r}=t;return{...r,codeFiles:e??[]}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadataJson:JSON.stringify(t.providerMetadata)};case"code-chat-code-import-ref":case"code-chat-image-import-ref":case"code-chat-diff-import-ref":case"code-chat-code-snapshot":return{type:t.type};case"code-chat-inspected-element-ref":{let{blobstoreContentKey:e,...r}=t;return r}case"code-chat-inspected-component":return{type:t.type,filePath:t.filePath,tagName:t.tagName};case"code-chat-inspected-library":return{type:t.type,folderPath:t.folderPath,libraryName:t.libraryName};case"code-chat-manual-edit":return{type:t.type,changedFilesJson:JSON.stringify(t.changedFiles),title:t.title,legacyS3CodeSnapshotKey:t.legacyS3CodeSnapshotKey};case"code-chat-duplicated-file":return{type:t.type,plainText:t.plainText,fileKeyHash:t.fileKeyHash};case"code-chat-deleted-chat-history":return{type:t.type,timestamp:t.timestamp,userId:t.userId??""};case"image":throw new i.T(`Not implemented: Conversion from part type ${t.type} to protobuf not implemented`);default:(0,l.xb)(t)}}function c({type:e,contentJson:t,blobstoreContentKey:r}){if(!(0,s.pQ)(e))throw new i.T(`Unknown message part type: ${e}`);let d=n.l[e].fromJSON(t),c={type:e,...d};switch(c.type){case"text":case"reasoning":case"redacted-reasoning":case"selected-node-ids":case"jsx":case"cortex-request-uuid":case"code-chat-assistant-code":case"code-chat-assistant-title":case"code-chat-model-config-version":case"code-chat-legacy-s3-code-snapshot":case"code-chat-errors":case"code-chat-library-keys":case"code-chat-legacy-assistant-tool-result":case"code-chat-snapshot-restore":case"code-chat-duplicated-file":case"code-chat-deleted-chat-history":case"code-chat-backfill-image-import":case"code-chat-backfill-code-import":case"code-chat-backfill-diff-import":case"code-chat-backfill-inspected-element":return c;case"code-chat-manual-edit":{let e;let{title:t,changedFilesJson:r,legacyS3CodeSnapshotKey:n}=d;try{let t=JSON.parse(r);e=a.Op.shape.changedFiles.parse(t)}catch(t){let e=t instanceof Error?t.message:String(t);throw new i.T(`Invalid changedFiles for code-chat-manual-edit: ${e}`)}return{type:"code-chat-manual-edit",changedFiles:e,title:t,legacyS3CodeSnapshotKey:n,blobstoreContentKey:void 0}}case"code-chat-origin":{let{origin:e}=d,t=a.Iw.shape.origin.safeParse(e);if(!t.success)throw new i.T(`Invalid origin for code-chat-origin: ${e}`);return{type:"code-chat-origin",origin:t.data}}case"tool-call-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,argsJson:r,providerOptions:i}=d;return{type:"tool-call",toolCallId:e,toolName:t,argsJSON:r,providerOptions:i}}case"tool-result-json-DO-NOT-USE-IN-PROD":{let{toolCallId:e,toolName:t,resultJson:r,isError:i}=d;return{type:"tool-result",toolCallId:e,toolName:t,resultJSON:r,isError:i}}case"tool-result-ref":{if(!r)throw new i.T("Blobstore content key is required for tool-result-ref");let{toolCallId:e,toolName:t,isError:a}=d;return{type:"tool-result-ref",toolCallId:e,toolName:t,isError:a,blobstoreContentKey:r}}case"code-chat-assistant-text":{let{text:e,textMode:t}=d,r=o.w_.safeParse(t);if(!r.success)throw new i.T(`Invalid textMode for code-chat-assistant-text: ${t}`);if("code"===r.data)throw new i.T("Code mode messages should be represented by code-chat-assistant-code, not code-chat-assistant-text");return{type:"code-chat-assistant-text",text:e,textMode:r.data}}case"code-chat-provider-metadata":return{type:"code-chat-provider-metadata",providerMetadata:JSON.parse(d.providerMetadataJson)};case"code-chat-code-snapshot":if(!r)throw new i.T("Blobstore content key is required for code-chat-code-snapshot");return{type:"code-chat-code-snapshot",blobstoreContentKey:r};case"code-chat-image-import-ref":if(!r)throw new i.T("Blobstore content key is required for code-chat-image-import-ref");return{type:"code-chat-image-import-ref",blobstoreContentKey:r};case"code-chat-code-import-ref":if(!r)throw new i.T("Blobstore content key is required for code-chat-code-import-ref");return{type:"code-chat-code-import-ref",blobstoreContentKey:r};case"code-chat-diff-import-ref":if(!r)throw new i.T("Blobstore content key is required for code-chat-diff-import-ref");return{type:"code-chat-diff-import-ref",blobstoreContentKey:r};case"code-chat-inspected-element-ref":{if(!r)throw new i.T("Blobstore content key is required for code-chat-inspected-element-ref");let{filePath:e,snippetStartLine:t,tagLine:a,tagName:n}=d;return{type:"code-chat-inspected-element-ref",filePath:e,snippetStartLine:t,tagLine:a,tagName:n,blobstoreContentKey:r}}case"code-chat-inspected-component":{let{filePath:e,tagName:t}=d;return{type:"code-chat-inspected-component",filePath:e,tagName:t}}case"code-chat-inspected-library":{let{folderPath:e,libraryName:t}=d;return{type:"code-chat-inspected-library",folderPath:e,libraryName:t}}case"text-ref":case"image-ref":case"reasoning-ref":case"redacted-reasoning-ref":case"tool-call-ref":case"figmake-test-part":throw new i.T(`Not implemented: Conversion from pb MessagePart type ${c.type} to AnyPart not implemented`);default:(0,l.xb)(c)}}},208821:(e,t,r)=>{function i(){return new DOMException("Operation aborted by user.","AbortError")}function a(e){return e instanceof DOMException&&"AbortError"===e.name}r.d(t,{N:()=>i,z:()=>a})},317523:(e,t,r)=>{r.d(t,{A:()=>i});function i(e){if("function"==typeof AbortSignal.any)return AbortSignal.any(e);let t=new AbortController;for(let r of e)if(r&&r.aborted){try{t.abort(r.reason)}catch{t.abort()}return t.signal}let r={},i=new FinalizationRegistry(e=>void e()),a=new WeakRef(t),n=e=>{let t=e?.target,r=t&&"reason"in t?t.reason:void 0;try{a.deref()?.abort(r)}catch{a.deref()?.abort()}},s=e.map(e=>new WeakRef(e)),o=()=>{for(let e of s)e.deref()?.removeEventListener("abort",n);i.unregister(r)};for(let t of e)t.addEventListener("abort",n,{once:!0});return t.signal.addEventListener("abort",o,{once:!0}),i.register(t.signal,o,r),t.signal}}}]);

//# debugId=3c85b371-be3e-5b55-98be-8c99e3b36a62

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/eefe98f9bfbfa6b127c30fb6e01fdfd33b037235/1211-f0be41d1a4dc7a71.min.js.map